name: deal_key_roles
primary_source_table: staging.staging_octane.deal_key_roles
primary_key:
- dkrs_pid
- dkrs_version
foreign_keys:
  fk_deal_key_roles_1:
    columns:
    - dkrs_deal_pid
    references:
      columns:
      - d_pid
      schema: history_octane
      table: deal
  fk_deal_key_roles_10:
    columns:
    - dkrs_final_documents_to_investor_lender_user_pid
    references:
      columns:
      - lu_pid
      schema: history_octane
      table: lender_user
  fk_deal_key_roles_11:
    columns:
    - dkrs_government_insurance_lender_user_pid
    references:
      columns:
      - lu_pid
      schema: history_octane
      table: lender_user
  fk_deal_key_roles_12:
    columns:
    - dkrs_funder_lender_user_pid
    references:
      columns:
      - lu_pid
      schema: history_octane
      table: lender_user
  fk_deal_key_roles_13:
    columns:
    - dkrs_processor_lender_user_pid
    references:
      columns:
      - lu_pid
      schema: history_octane
      table: lender_user
  fk_deal_key_roles_14:
    columns:
    - dkrs_underwriter_lender_user_pid
    references:
      columns:
      - lu_pid
      schema: history_octane
      table: lender_user
  fk_deal_key_roles_15:
    columns:
    - dkrs_project_underwriter_lender_user_pid
    references:
      columns:
      - lu_pid
      schema: history_octane
      table: lender_user
  fk_deal_key_roles_16:
    columns:
    - dkrs_closing_doc_specialist_lender_user_pid
    references:
      columns:
      - lu_pid
      schema: history_octane
      table: lender_user
  fk_deal_key_roles_17:
    columns:
    - dkrs_wholesale_client_advocate_lender_user_pid
    references:
      columns:
      - lu_pid
      schema: history_octane
      table: lender_user
  fk_deal_key_roles_18:
    columns:
    - dkrs_closing_scheduler_lender_user_pid
    references:
      columns:
      - lu_pid
      schema: history_octane
      table: lender_user
  fk_deal_key_roles_19:
    columns:
    - dkrs_collateral_underwriter_lender_user_pid
    references:
      columns:
      - lu_pid
      schema: history_octane
      table: lender_user
  fk_deal_key_roles_2:
    columns:
    - dkrs_originator_lender_user_pid
    references:
      columns:
      - lu_pid
      schema: history_octane
      table: lender_user
  fk_deal_key_roles_20:
    columns:
    - dkrs_correspondent_client_advocate_lender_user_pid
    references:
      columns:
      - lu_pid
      schema: history_octane
      table: lender_user
  fk_deal_key_roles_21:
    columns:
    - dkrs_flood_insurance_specialist_lender_user_pid
    references:
      columns:
      - lu_pid
      schema: history_octane
      table: lender_user
  fk_deal_key_roles_22:
    columns:
    - dkrs_hoa_specialist_lender_user_pid
    references:
      columns:
      - lu_pid
      schema: history_octane
      table: lender_user
  fk_deal_key_roles_23:
    columns:
    - dkrs_hoi_specialist_lender_user_pid
    references:
      columns:
      - lu_pid
      schema: history_octane
      table: lender_user
  fk_deal_key_roles_24:
    columns:
    - dkrs_ho6_specialist_lender_user_pid
    references:
      columns:
      - lu_pid
      schema: history_octane
      table: lender_user
  fk_deal_key_roles_25:
    columns:
    - dkrs_hud_va_lender_officer_lender_user_pid
    references:
      columns:
      - lu_pid
      schema: history_octane
      table: lender_user
  fk_deal_key_roles_26:
    columns:
    - dkrs_loan_officer_assistant_lender_user_pid
    references:
      columns:
      - lu_pid
      schema: history_octane
      table: lender_user
  fk_deal_key_roles_27:
    columns:
    - dkrs_loan_payoff_specialist_lender_user_pid
    references:
      columns:
      - lu_pid
      schema: history_octane
      table: lender_user
  fk_deal_key_roles_28:
    columns:
    - dkrs_subordination_specialist_lender_user_pid
    references:
      columns:
      - lu_pid
      schema: history_octane
      table: lender_user
  fk_deal_key_roles_29:
    columns:
    - dkrs_title_specialist_lender_user_pid
    references:
      columns:
      - lu_pid
      schema: history_octane
      table: lender_user
  fk_deal_key_roles_3:
    columns:
    - dkrs_supplemental_originator_lender_user_pid
    references:
      columns:
      - lu_pid
      schema: history_octane
      table: lender_user
  fk_deal_key_roles_30:
    columns:
    - dkrs_underwriting_manager_lender_user_pid
    references:
      columns:
      - lu_pid
      schema: history_octane
      table: lender_user
  fk_deal_key_roles_31:
    columns:
    - dkrs_va_specialist_lender_user_pid
    references:
      columns:
      - lu_pid
      schema: history_octane
      table: lender_user
  fk_deal_key_roles_32:
    columns:
    - dkrs_verbal_voe_specialist_lender_user_pid
    references:
      columns:
      - lu_pid
      schema: history_octane
      table: lender_user
  fk_deal_key_roles_33:
    columns:
    - dkrs_voe_specialist_lender_user_pid
    references:
      columns:
      - lu_pid
      schema: history_octane
      table: lender_user
  fk_deal_key_roles_34:
    columns:
    - dkrs_wire_specialist_lender_user_pid
    references:
      columns:
      - lu_pid
      schema: history_octane
      table: lender_user
  fk_deal_key_roles_35:
    columns:
    - dkrs_internal_construction_manager_lender_user_pid
    references:
      columns:
      - lu_pid
      schema: history_octane
      table: lender_user
  fk_deal_key_roles_36:
    columns:
    - dkrs_review_requester_1_lender_user_pid
    references:
      columns:
      - lu_pid
      schema: history_octane
      table: lender_user
  fk_deal_key_roles_37:
    columns:
    - dkrs_review_requester_2_lender_user_pid
    references:
      columns:
      - lu_pid
      schema: history_octane
      table: lender_user
  fk_deal_key_roles_38:
    columns:
    - dkrs_review_requester_3_lender_user_pid
    references:
      columns:
      - lu_pid
      schema: history_octane
      table: lender_user
  fk_deal_key_roles_39:
    columns:
    - dkrs_review_requester_4_lender_user_pid
    references:
      columns:
      - lu_pid
      schema: history_octane
      table: lender_user
  fk_deal_key_roles_4:
    columns:
    - dkrs_account_executive_lender_user_pid
    references:
      columns:
      - lu_pid
      schema: history_octane
      table: lender_user
  fk_deal_key_roles_40:
    columns:
    - dkrs_review_requester_5_lender_user_pid
    references:
      columns:
      - lu_pid
      schema: history_octane
      table: lender_user
  fk_deal_key_roles_5:
    columns:
    - dkrs_investor_conditions_lender_user_pid
    references:
      columns:
      - lu_pid
      schema: history_octane
      table: lender_user
  fk_deal_key_roles_6:
    columns:
    - dkrs_investor_stack_to_investor_lender_user_pid
    references:
      columns:
      - lu_pid
      schema: history_octane
      table: lender_user
  fk_deal_key_roles_7:
    columns:
    - dkrs_collateral_to_custodian_lender_user_pid
    references:
      columns:
      - lu_pid
      schema: history_octane
      table: lender_user
  fk_deal_key_roles_8:
    columns:
    - dkrs_collateral_to_investor_lender_user_pid
    references:
      columns:
      - lu_pid
      schema: history_octane
      table: lender_user
  fk_deal_key_roles_9:
    columns:
    - dkrs_transaction_assistant_lender_user_pid
    references:
      columns:
      - lu_pid
      schema: history_octane
      table: lender_user
columns:
  dkrs_pid:
    data_type: BIGINT
    source:
      field: primary_source_table.columns.dkrs_pid
  dkrs_version:
    data_type: INTEGER
    source:
      field: primary_source_table.columns.dkrs_version
  dkrs_deal_pid:
    data_type: BIGINT
    source:
      field: primary_source_table.columns.dkrs_deal_pid
  dkrs_originator_lender_user_pid:
    data_type: BIGINT
    source:
      field: primary_source_table.columns.dkrs_originator_lender_user_pid
  dkrs_originator_first_name:
    data_type: VARCHAR(32)
    source:
      field: primary_source_table.columns.dkrs_originator_first_name
  dkrs_originator_last_name:
    data_type: VARCHAR(32)
    source:
      field: primary_source_table.columns.dkrs_originator_last_name
  dkrs_originator_middle_name:
    data_type: VARCHAR(32)
    source:
      field: primary_source_table.columns.dkrs_originator_middle_name
  dkrs_originator_fmls_basic:
    data_type: VARCHAR(128)
    source:
      field: primary_source_table.columns.dkrs_originator_fmls_basic
  dkrs_originator_nmls_id:
    data_type: VARCHAR(16)
    source:
      field: primary_source_table.columns.dkrs_originator_nmls_id
  dkrs_supplemental_originator_lender_user_pid:
    data_type: BIGINT
    source:
      field: primary_source_table.columns.dkrs_supplemental_originator_lender_user_pid
  dkrs_supplemental_originator_fmls:
    data_type: VARCHAR(128)
    source:
      field: primary_source_table.columns.dkrs_supplemental_originator_fmls
  dkrs_account_executive_lender_user_pid:
    data_type: BIGINT
    source:
      field: primary_source_table.columns.dkrs_account_executive_lender_user_pid
  dkrs_account_executive_fmls:
    data_type: VARCHAR(128)
    source:
      field: primary_source_table.columns.dkrs_account_executive_fmls
  dkrs_investor_conditions_lender_user_pid:
    data_type: BIGINT
    source:
      field: primary_source_table.columns.dkrs_investor_conditions_lender_user_pid
  dkrs_investor_conditions_fmls:
    data_type: VARCHAR(128)
    source:
      field: primary_source_table.columns.dkrs_investor_conditions_fmls
  dkrs_investor_stack_to_investor_lender_user_pid:
    data_type: BIGINT
    source:
      field: primary_source_table.columns.dkrs_investor_stack_to_investor_lender_user_pid
  dkrs_investor_stack_to_investor_fmls:
    data_type: VARCHAR(128)
    source:
      field: primary_source_table.columns.dkrs_investor_stack_to_investor_fmls
  dkrs_collateral_to_custodian_lender_user_pid:
    data_type: BIGINT
    source:
      field: primary_source_table.columns.dkrs_collateral_to_custodian_lender_user_pid
  dkrs_collateral_to_custodian_fmls:
    data_type: VARCHAR(128)
    source:
      field: primary_source_table.columns.dkrs_collateral_to_custodian_fmls
  dkrs_collateral_to_investor_lender_user_pid:
    data_type: BIGINT
    source:
      field: primary_source_table.columns.dkrs_collateral_to_investor_lender_user_pid
  dkrs_collateral_to_investor_fmls:
    data_type: VARCHAR(128)
    source:
      field: primary_source_table.columns.dkrs_collateral_to_investor_fmls
  dkrs_transaction_assistant_lender_user_pid:
    data_type: BIGINT
    source:
      field: primary_source_table.columns.dkrs_transaction_assistant_lender_user_pid
  dkrs_transaction_assistant_fmls:
    data_type: VARCHAR(128)
    source:
      field: primary_source_table.columns.dkrs_transaction_assistant_fmls
  dkrs_final_documents_to_investor_lender_user_pid:
    data_type: BIGINT
    source:
      field: primary_source_table.columns.dkrs_final_documents_to_investor_lender_user_pid
  dkrs_final_documents_to_investor_fmls:
    data_type: VARCHAR(128)
    source:
      field: primary_source_table.columns.dkrs_final_documents_to_investor_fmls
  dkrs_government_insurance_lender_user_pid:
    data_type: BIGINT
    source:
      field: primary_source_table.columns.dkrs_government_insurance_lender_user_pid
  dkrs_government_insurance_fmls:
    data_type: VARCHAR(128)
    source:
      field: primary_source_table.columns.dkrs_government_insurance_fmls
  dkrs_funder_lender_user_pid:
    data_type: BIGINT
    source:
      field: primary_source_table.columns.dkrs_funder_lender_user_pid
  dkrs_funder_fmls:
    data_type: VARCHAR(128)
    source:
      field: primary_source_table.columns.dkrs_funder_fmls
  dkrs_processor_lender_user_pid:
    data_type: BIGINT
    source:
      field: primary_source_table.columns.dkrs_processor_lender_user_pid
  dkrs_processor_fmls:
    data_type: VARCHAR(128)
    source:
      field: primary_source_table.columns.dkrs_processor_fmls
  dkrs_underwriter_lender_user_pid:
    data_type: BIGINT
    source:
      field: primary_source_table.columns.dkrs_underwriter_lender_user_pid
  dkrs_underwriter_fmls:
    data_type: VARCHAR(128)
    source:
      field: primary_source_table.columns.dkrs_underwriter_fmls
  dkrs_project_underwriter_lender_user_pid:
    data_type: BIGINT
    source:
      field: primary_source_table.columns.dkrs_project_underwriter_lender_user_pid
  dkrs_project_underwriter_fmls:
    data_type: VARCHAR(128)
    source:
      field: primary_source_table.columns.dkrs_project_underwriter_fmls
  dkrs_closing_doc_specialist_lender_user_pid:
    data_type: BIGINT
    source:
      field: primary_source_table.columns.dkrs_closing_doc_specialist_lender_user_pid
  dkrs_closing_doc_specialist_fmls:
    data_type: VARCHAR(128)
    source:
      field: primary_source_table.columns.dkrs_closing_doc_specialist_fmls
  dkrs_wholesale_client_advocate_lender_user_pid:
    data_type: BIGINT
    source:
      field: primary_source_table.columns.dkrs_wholesale_client_advocate_lender_user_pid
  dkrs_wholesale_client_advocate_fmls:
    data_type: VARCHAR(128)
    source:
      field: primary_source_table.columns.dkrs_wholesale_client_advocate_fmls
  dkrs_closing_scheduler_lender_user_pid:
    data_type: BIGINT
    source:
      field: primary_source_table.columns.dkrs_closing_scheduler_lender_user_pid
  dkrs_closing_scheduler_fmls:
    data_type: VARCHAR(128)
    source:
      field: primary_source_table.columns.dkrs_closing_scheduler_fmls
  dkrs_collateral_underwriter_lender_user_pid:
    data_type: BIGINT
    source:
      field: primary_source_table.columns.dkrs_collateral_underwriter_lender_user_pid
  dkrs_collateral_underwriter_fmls:
    data_type: VARCHAR(128)
    source:
      field: primary_source_table.columns.dkrs_collateral_underwriter_fmls
  dkrs_correspondent_client_advocate_lender_user_pid:
    data_type: BIGINT
    source:
      field: primary_source_table.columns.dkrs_correspondent_client_advocate_lender_user_pid
  dkrs_correspondent_client_advocate_fmls:
    data_type: VARCHAR(128)
    source:
      field: primary_source_table.columns.dkrs_correspondent_client_advocate_fmls
  dkrs_flood_insurance_specialist_lender_user_pid:
    data_type: BIGINT
    source:
      field: primary_source_table.columns.dkrs_flood_insurance_specialist_lender_user_pid
  dkrs_flood_insurance_specialist_fmls:
    data_type: VARCHAR(128)
    source:
      field: primary_source_table.columns.dkrs_flood_insurance_specialist_fmls
  dkrs_hoa_specialist_lender_user_pid:
    data_type: BIGINT
    source:
      field: primary_source_table.columns.dkrs_hoa_specialist_lender_user_pid
  dkrs_hoa_specialist_fmls:
    data_type: VARCHAR(128)
    source:
      field: primary_source_table.columns.dkrs_hoa_specialist_fmls
  dkrs_hoi_specialist_lender_user_pid:
    data_type: BIGINT
    source:
      field: primary_source_table.columns.dkrs_hoi_specialist_lender_user_pid
  dkrs_hoi_specialist_fmls:
    data_type: VARCHAR(128)
    source:
      field: primary_source_table.columns.dkrs_hoi_specialist_fmls
  dkrs_ho6_specialist_lender_user_pid:
    data_type: BIGINT
    source:
      field: primary_source_table.columns.dkrs_ho6_specialist_lender_user_pid
  dkrs_ho6_specialist_fmls:
    data_type: VARCHAR(128)
    source:
      field: primary_source_table.columns.dkrs_ho6_specialist_fmls
  dkrs_hud_va_lender_officer_lender_user_pid:
    data_type: BIGINT
    source:
      field: primary_source_table.columns.dkrs_hud_va_lender_officer_lender_user_pid
  dkrs_hud_va_lender_officer_fmls:
    data_type: VARCHAR(128)
    source:
      field: primary_source_table.columns.dkrs_hud_va_lender_officer_fmls
  dkrs_loan_officer_assistant_lender_user_pid:
    data_type: BIGINT
    source:
      field: primary_source_table.columns.dkrs_loan_officer_assistant_lender_user_pid
  dkrs_loan_officer_assistant_fmls:
    data_type: VARCHAR(128)
    source:
      field: primary_source_table.columns.dkrs_loan_officer_assistant_fmls
  dkrs_loan_payoff_specialist_lender_user_pid:
    data_type: BIGINT
    source:
      field: primary_source_table.columns.dkrs_loan_payoff_specialist_lender_user_pid
  dkrs_loan_payoff_specialist_fmls:
    data_type: VARCHAR(128)
    source:
      field: primary_source_table.columns.dkrs_loan_payoff_specialist_fmls
  dkrs_subordination_specialist_lender_user_pid:
    data_type: BIGINT
    source:
      field: primary_source_table.columns.dkrs_subordination_specialist_lender_user_pid
  dkrs_subordination_specialist_fmls:
    data_type: VARCHAR(128)
    source:
      field: primary_source_table.columns.dkrs_subordination_specialist_fmls
  dkrs_title_specialist_lender_user_pid:
    data_type: BIGINT
    source:
      field: primary_source_table.columns.dkrs_title_specialist_lender_user_pid
  dkrs_title_specialist_fmls:
    data_type: VARCHAR(128)
    source:
      field: primary_source_table.columns.dkrs_title_specialist_fmls
  dkrs_underwriting_manager_lender_user_pid:
    data_type: BIGINT
    source:
      field: primary_source_table.columns.dkrs_underwriting_manager_lender_user_pid
  dkrs_underwriting_manager_fmls:
    data_type: VARCHAR(128)
    source:
      field: primary_source_table.columns.dkrs_underwriting_manager_fmls
  dkrs_va_specialist_lender_user_pid:
    data_type: BIGINT
    source:
      field: primary_source_table.columns.dkrs_va_specialist_lender_user_pid
  dkrs_va_specialist_fmls:
    data_type: VARCHAR(128)
    source:
      field: primary_source_table.columns.dkrs_va_specialist_fmls
  dkrs_verbal_voe_specialist_lender_user_pid:
    data_type: BIGINT
    source:
      field: primary_source_table.columns.dkrs_verbal_voe_specialist_lender_user_pid
  dkrs_verbal_voe_specialist_fmls:
    data_type: VARCHAR(128)
    source:
      field: primary_source_table.columns.dkrs_verbal_voe_specialist_fmls
  dkrs_voe_specialist_lender_user_pid:
    data_type: BIGINT
    source:
      field: primary_source_table.columns.dkrs_voe_specialist_lender_user_pid
  dkrs_voe_specialist_fmls:
    data_type: VARCHAR(128)
    source:
      field: primary_source_table.columns.dkrs_voe_specialist_fmls
  dkrs_wire_specialist_lender_user_pid:
    data_type: BIGINT
    source:
      field: primary_source_table.columns.dkrs_wire_specialist_lender_user_pid
  dkrs_wire_specialist_fmls:
    data_type: VARCHAR(128)
    source:
      field: primary_source_table.columns.dkrs_wire_specialist_fmls
  dkrs_internal_construction_manager_lender_user_pid:
    data_type: BIGINT
    source:
      field: primary_source_table.columns.dkrs_internal_construction_manager_lender_user_pid
  dkrs_internal_construction_manager_fmls:
    data_type: VARCHAR(128)
    source:
      field: primary_source_table.columns.dkrs_internal_construction_manager_fmls
  dkrs_review_requester_1_lender_user_pid:
    data_type: BIGINT
    source:
      field: primary_source_table.columns.dkrs_review_requester_1_lender_user_pid
  dkrs_review_requester_1_fmls:
    data_type: VARCHAR(128)
    source:
      field: primary_source_table.columns.dkrs_review_requester_1_fmls
  dkrs_review_requester_2_lender_user_pid:
    data_type: BIGINT
    source:
      field: primary_source_table.columns.dkrs_review_requester_2_lender_user_pid
  dkrs_review_requester_2_fmls:
    data_type: VARCHAR(128)
    source:
      field: primary_source_table.columns.dkrs_review_requester_2_fmls
  dkrs_review_requester_3_lender_user_pid:
    data_type: BIGINT
    source:
      field: primary_source_table.columns.dkrs_review_requester_3_lender_user_pid
  dkrs_review_requester_3_fmls:
    data_type: VARCHAR(128)
    source:
      field: primary_source_table.columns.dkrs_review_requester_3_fmls
  dkrs_review_requester_4_lender_user_pid:
    data_type: BIGINT
    source:
      field: primary_source_table.columns.dkrs_review_requester_4_lender_user_pid
  dkrs_review_requester_4_fmls:
    data_type: VARCHAR(128)
    source:
      field: primary_source_table.columns.dkrs_review_requester_4_fmls
  dkrs_review_requester_5_lender_user_pid:
    data_type: BIGINT
    source:
      field: primary_source_table.columns.dkrs_review_requester_5_lender_user_pid
  dkrs_review_requester_5_fmls:
    data_type: VARCHAR(128)
    source:
      field: primary_source_table.columns.dkrs_review_requester_5_fmls
  data_source_updated_datetime:
    data_type: TIMESTAMPTZ
  data_source_deleted_flag:
    data_type: BOOLEAN
  etl_batch_id:
    data_type: TEXT
etls:
  SP-100017:
    input_type: table
    output_type: insert
    json_output_field: dkrs_pid
    truncate_table: false
    input_sql: |-
      --finding records to insert into history_octane.deal_key_roles
      SELECT staging_table.dkrs_pid
           , staging_table.dkrs_version
           , staging_table.dkrs_deal_pid
           , staging_table.dkrs_originator_lender_user_pid
           , staging_table.dkrs_originator_first_name
           , staging_table.dkrs_originator_last_name
           , staging_table.dkrs_originator_middle_name
           , staging_table.dkrs_originator_fmls_basic
           , staging_table.dkrs_originator_nmls_id
           , staging_table.dkrs_supplemental_originator_lender_user_pid
           , staging_table.dkrs_supplemental_originator_fmls
           , staging_table.dkrs_account_executive_lender_user_pid
           , staging_table.dkrs_account_executive_fmls
           , staging_table.dkrs_investor_conditions_lender_user_pid
           , staging_table.dkrs_investor_conditions_fmls
           , staging_table.dkrs_investor_stack_to_investor_lender_user_pid
           , staging_table.dkrs_investor_stack_to_investor_fmls
           , staging_table.dkrs_collateral_to_custodian_lender_user_pid
           , staging_table.dkrs_collateral_to_custodian_fmls
           , staging_table.dkrs_collateral_to_investor_lender_user_pid
           , staging_table.dkrs_collateral_to_investor_fmls
           , staging_table.dkrs_transaction_assistant_lender_user_pid
           , staging_table.dkrs_transaction_assistant_fmls
           , staging_table.dkrs_final_documents_to_investor_lender_user_pid
           , staging_table.dkrs_final_documents_to_investor_fmls
           , staging_table.dkrs_government_insurance_lender_user_pid
           , staging_table.dkrs_government_insurance_fmls
           , staging_table.dkrs_funder_lender_user_pid
           , staging_table.dkrs_funder_fmls
           , staging_table.dkrs_processor_lender_user_pid
           , staging_table.dkrs_processor_fmls
           , staging_table.dkrs_underwriter_lender_user_pid
           , staging_table.dkrs_underwriter_fmls
           , staging_table.dkrs_project_underwriter_lender_user_pid
           , staging_table.dkrs_project_underwriter_fmls
           , staging_table.dkrs_closing_doc_specialist_lender_user_pid
           , staging_table.dkrs_closing_doc_specialist_fmls
           , staging_table.dkrs_wholesale_client_advocate_lender_user_pid
           , staging_table.dkrs_wholesale_client_advocate_fmls
           , staging_table.dkrs_closing_scheduler_lender_user_pid
           , staging_table.dkrs_closing_scheduler_fmls
           , staging_table.dkrs_collateral_underwriter_lender_user_pid
           , staging_table.dkrs_collateral_underwriter_fmls
           , staging_table.dkrs_correspondent_client_advocate_lender_user_pid
           , staging_table.dkrs_correspondent_client_advocate_fmls
           , staging_table.dkrs_flood_insurance_specialist_lender_user_pid
           , staging_table.dkrs_flood_insurance_specialist_fmls
           , staging_table.dkrs_hoa_specialist_lender_user_pid
           , staging_table.dkrs_hoa_specialist_fmls
           , staging_table.dkrs_hoi_specialist_lender_user_pid
           , staging_table.dkrs_hoi_specialist_fmls
           , staging_table.dkrs_ho6_specialist_lender_user_pid
           , staging_table.dkrs_ho6_specialist_fmls
           , staging_table.dkrs_hud_va_lender_officer_lender_user_pid
           , staging_table.dkrs_hud_va_lender_officer_fmls
           , staging_table.dkrs_loan_officer_assistant_lender_user_pid
           , staging_table.dkrs_loan_officer_assistant_fmls
           , staging_table.dkrs_loan_payoff_specialist_lender_user_pid
           , staging_table.dkrs_loan_payoff_specialist_fmls
           , staging_table.dkrs_subordination_specialist_lender_user_pid
           , staging_table.dkrs_subordination_specialist_fmls
           , staging_table.dkrs_title_specialist_lender_user_pid
           , staging_table.dkrs_title_specialist_fmls
           , staging_table.dkrs_underwriting_manager_lender_user_pid
           , staging_table.dkrs_underwriting_manager_fmls
           , staging_table.dkrs_va_specialist_lender_user_pid
           , staging_table.dkrs_va_specialist_fmls
           , staging_table.dkrs_verbal_voe_specialist_lender_user_pid
           , staging_table.dkrs_verbal_voe_specialist_fmls
           , staging_table.dkrs_voe_specialist_lender_user_pid
           , staging_table.dkrs_voe_specialist_fmls
           , staging_table.dkrs_wire_specialist_lender_user_pid
           , staging_table.dkrs_wire_specialist_fmls
           , staging_table.dkrs_internal_construction_manager_lender_user_pid
           , staging_table.dkrs_internal_construction_manager_fmls
           , staging_table.dkrs_review_requester_1_lender_user_pid
           , staging_table.dkrs_review_requester_1_fmls
           , staging_table.dkrs_review_requester_2_lender_user_pid
           , staging_table.dkrs_review_requester_2_fmls
           , staging_table.dkrs_review_requester_3_lender_user_pid
           , staging_table.dkrs_review_requester_3_fmls
           , staging_table.dkrs_review_requester_4_lender_user_pid
           , staging_table.dkrs_review_requester_4_fmls
           , staging_table.dkrs_review_requester_5_lender_user_pid
           , staging_table.dkrs_review_requester_5_fmls
           , FALSE AS data_source_deleted_flag
           , NOW( ) AS data_source_updated_datetime
      FROM staging_octane.deal_key_roles staging_table
      LEFT JOIN history_octane.deal_key_roles history_table
                ON staging_table.dkrs_pid = history_table.dkrs_pid
                    AND staging_table.dkrs_version = history_table.dkrs_version
      WHERE history_table.dkrs_pid IS NULL
      UNION ALL
      SELECT history_table.dkrs_pid
           , history_table.dkrs_version + 1
           , history_table.dkrs_deal_pid
           , history_table.dkrs_originator_lender_user_pid
           , history_table.dkrs_originator_first_name
           , history_table.dkrs_originator_last_name
           , history_table.dkrs_originator_middle_name
           , history_table.dkrs_originator_fmls_basic
           , history_table.dkrs_originator_nmls_id
           , history_table.dkrs_supplemental_originator_lender_user_pid
           , history_table.dkrs_supplemental_originator_fmls
           , history_table.dkrs_account_executive_lender_user_pid
           , history_table.dkrs_account_executive_fmls
           , history_table.dkrs_investor_conditions_lender_user_pid
           , history_table.dkrs_investor_conditions_fmls
           , history_table.dkrs_investor_stack_to_investor_lender_user_pid
           , history_table.dkrs_investor_stack_to_investor_fmls
           , history_table.dkrs_collateral_to_custodian_lender_user_pid
           , history_table.dkrs_collateral_to_custodian_fmls
           , history_table.dkrs_collateral_to_investor_lender_user_pid
           , history_table.dkrs_collateral_to_investor_fmls
           , history_table.dkrs_transaction_assistant_lender_user_pid
           , history_table.dkrs_transaction_assistant_fmls
           , history_table.dkrs_final_documents_to_investor_lender_user_pid
           , history_table.dkrs_final_documents_to_investor_fmls
           , history_table.dkrs_government_insurance_lender_user_pid
           , history_table.dkrs_government_insurance_fmls
           , history_table.dkrs_funder_lender_user_pid
           , history_table.dkrs_funder_fmls
           , history_table.dkrs_processor_lender_user_pid
           , history_table.dkrs_processor_fmls
           , history_table.dkrs_underwriter_lender_user_pid
           , history_table.dkrs_underwriter_fmls
           , history_table.dkrs_project_underwriter_lender_user_pid
           , history_table.dkrs_project_underwriter_fmls
           , history_table.dkrs_closing_doc_specialist_lender_user_pid
           , history_table.dkrs_closing_doc_specialist_fmls
           , history_table.dkrs_wholesale_client_advocate_lender_user_pid
           , history_table.dkrs_wholesale_client_advocate_fmls
           , history_table.dkrs_closing_scheduler_lender_user_pid
           , history_table.dkrs_closing_scheduler_fmls
           , history_table.dkrs_collateral_underwriter_lender_user_pid
           , history_table.dkrs_collateral_underwriter_fmls
           , history_table.dkrs_correspondent_client_advocate_lender_user_pid
           , history_table.dkrs_correspondent_client_advocate_fmls
           , history_table.dkrs_flood_insurance_specialist_lender_user_pid
           , history_table.dkrs_flood_insurance_specialist_fmls
           , history_table.dkrs_hoa_specialist_lender_user_pid
           , history_table.dkrs_hoa_specialist_fmls
           , history_table.dkrs_hoi_specialist_lender_user_pid
           , history_table.dkrs_hoi_specialist_fmls
           , history_table.dkrs_ho6_specialist_lender_user_pid
           , history_table.dkrs_ho6_specialist_fmls
           , history_table.dkrs_hud_va_lender_officer_lender_user_pid
           , history_table.dkrs_hud_va_lender_officer_fmls
           , history_table.dkrs_loan_officer_assistant_lender_user_pid
           , history_table.dkrs_loan_officer_assistant_fmls
           , history_table.dkrs_loan_payoff_specialist_lender_user_pid
           , history_table.dkrs_loan_payoff_specialist_fmls
           , history_table.dkrs_subordination_specialist_lender_user_pid
           , history_table.dkrs_subordination_specialist_fmls
           , history_table.dkrs_title_specialist_lender_user_pid
           , history_table.dkrs_title_specialist_fmls
           , history_table.dkrs_underwriting_manager_lender_user_pid
           , history_table.dkrs_underwriting_manager_fmls
           , history_table.dkrs_va_specialist_lender_user_pid
           , history_table.dkrs_va_specialist_fmls
           , history_table.dkrs_verbal_voe_specialist_lender_user_pid
           , history_table.dkrs_verbal_voe_specialist_fmls
           , history_table.dkrs_voe_specialist_lender_user_pid
           , history_table.dkrs_voe_specialist_fmls
           , history_table.dkrs_wire_specialist_lender_user_pid
           , history_table.dkrs_wire_specialist_fmls
           , history_table.dkrs_internal_construction_manager_lender_user_pid
           , history_table.dkrs_internal_construction_manager_fmls
           , history_table.dkrs_review_requester_1_lender_user_pid
           , history_table.dkrs_review_requester_1_fmls
           , history_table.dkrs_review_requester_2_lender_user_pid
           , history_table.dkrs_review_requester_2_fmls
           , history_table.dkrs_review_requester_3_lender_user_pid
           , history_table.dkrs_review_requester_3_fmls
           , history_table.dkrs_review_requester_4_lender_user_pid
           , history_table.dkrs_review_requester_4_fmls
           , history_table.dkrs_review_requester_5_lender_user_pid
           , history_table.dkrs_review_requester_5_fmls
           , TRUE AS data_source_deleted_flag
           , NOW( ) AS data_source_updated_datetime
      FROM history_octane.deal_key_roles history_table
      LEFT JOIN staging_octane.deal_key_roles staging_table
                ON staging_table.dkrs_pid = history_table.dkrs_pid
      WHERE staging_table.dkrs_pid IS NULL
        AND NOT EXISTS(
          SELECT 1
          FROM history_octane.deal_key_roles deleted_records
          WHERE deleted_records.dkrs_pid = history_table.dkrs_pid
            AND deleted_records.data_source_deleted_flag = TRUE
          );
next_etls:
- SP-300001-insert-update
