name: borrower_dim
primary_source_table: staging.history_octane.borrower
primary_key:
- dwid
columns:
  dwid:
    data_type: BIGINT
    update_flag: false
  data_source_dwid:
    data_type: BIGINT
    update_flag: true
  edw_created_datetime:
    data_type: TIMESTAMPTZ
    update_flag: false
  edw_modified_datetime:
    data_type: TIMESTAMPTZ
    update_flag: true
  etl_batch_id:
    data_type: TEXT
    update_flag: true
  data_source_integration_columns:
    data_type: TEXT
    update_flag: true
  data_source_integration_id:
    data_type: TEXT
    update_flag: false
  data_source_modified_datetime:
    data_type: TIMESTAMPTZ
    update_flag: false
  borrower_pid:
    data_type: BIGINT
    source:
      field: primary_source_table.columns.b_pid
    update_flag: true
  application_pid:
    data_type: BIGINT
    source:
      field: primary_source_table.columns.b_application_pid
    update_flag: true
  alimony_child_support_explanation:
    data_type: VARCHAR(128)
    source:
      field: primary_source_table.columns.b_alimony_child_support_explanation
    update_flag: true
  applicant_role:
    data_type: VARCHAR(1024)
    source:
      field: primary_source_table.foreign_keys.fkt_b_applicant_role_type.columns.value
    update_flag: true
  applicant_role_code:
    data_type: VARCHAR(128)
    source:
      field: primary_source_table.columns.b_applicant_role_type
    update_flag: true
  application_taken_method:
    data_type: VARCHAR(1024)
    source:
      field: primary_source_table.foreign_keys.fkt_b_application_taken_method_type.columns.value
    update_flag: true
  application_taken_method_code:
    data_type: VARCHAR(128)
    source:
      field: primary_source_table.columns.b_application_taken_method_type
    update_flag: true
  bankruptcy_explanation:
    data_type: VARCHAR(128)
    source:
      field: primary_source_table.columns.b_bankruptcy_explanation
    update_flag: true
  birth_date:
    data_type: DATE
    source:
      field: primary_source_table.columns.b_birth_date
    update_flag: true
  borrowed_down_payment_explanation:
    data_type: VARCHAR(128)
    source:
      field: primary_source_table.columns.b_borrowed_down_payment_explanation
    update_flag: true
  caivrs_id:
    data_type: VARCHAR(16)
    source:
      field: primary_source_table.columns.b_caivrs_id
    update_flag: true
  caivrs_messages:
    data_type: TEXT
    source:
      field: primary_source_table.columns.b_caivrs_messages
    update_flag: true
  credit_report_authorization_datetime:
    data_type: TIMESTAMPTZ
    source:
      field: primary_source_table.columns.b_credit_report_authorization_datetime
    update_flag: true
  credit_report_authorization_method:
    data_type: VARCHAR(1024)
    source:
      field: primary_source_table.foreign_keys.fkt_b_credit_report_authorization_method.columns.value
    update_flag: true
  credit_report_authorization_method_code:
    data_type: VARCHAR(128)
    source:
      field: primary_source_table.columns.b_credit_report_authorization_method
    update_flag: true
  credit_report_authorization_obtained_by_unparsed_name:
    data_type: VARCHAR(128)
    source:
      field: primary_source_table.columns.b_credit_report_authorization_obtained_by_unparsed_name
    update_flag: true
  credit_report_identifier:
    data_type: VARCHAR(32)
    source:
      field: primary_source_table.columns.b_credit_report_identifier
    update_flag: true
  decision_credit_score:
    data_type: INTEGER
    source:
      field: primary_source_table.columns.b_decision_credit_score
    update_flag: true
  dependent_count:
    data_type: INTEGER
    source:
      field: primary_source_table.columns.b_dependent_count
    update_flag: true
  dependents_age_years:
    data_type: VARCHAR(32)
    source:
      field: primary_source_table.columns.b_dependents_age_years
    update_flag: true
  email:
    data_type: VARCHAR(256)
    source:
      field: primary_source_table.columns.b_email
    update_flag: true
  equifax_credit_score:
    data_type: INTEGER
    source:
      field: primary_source_table.columns.b_equifax_credit_score
    update_flag: true
  ethnicity_other_hispanic_or_latino_description:
    data_type: VARCHAR(100)
    source:
      field: primary_source_table.columns.b_ethnicity_other_hispanic_or_latino_description
    update_flag: true
  experian_credit_score:
    data_type: INTEGER
    source:
      field: primary_source_table.columns.b_experian_credit_score
    update_flag: true
  fax:
    data_type: VARCHAR(32)
    source:
      field: primary_source_table.columns.b_fax
    update_flag: true
  first_name:
    data_type: VARCHAR(32)
    source:
      field: primary_source_table.columns.b_first_name
    update_flag: true
  first_time_homebuyer_explain:
    data_type: VARCHAR(1024)
    source:
      field: primary_source_table.columns.b_first_time_home_buyer_explain
    update_flag: true
  credit_report_authorization_flag:
    data_type: BOOLEAN
    source:
      field: primary_source_table.columns.b_credit_report_authorization
    update_flag: true
  has_no_ssn_flag:
    data_type: BOOLEAN
    source:
      field: primary_source_table.columns.b_has_no_ssn
    update_flag: true
  power_of_attorney:
    data_type: VARCHAR(1024)
    source:
      field: primary_source_table.foreign_keys.fkt_b_power_of_attorney.columns.value
    update_flag: true
  power_of_attorney_code:
    data_type: VARCHAR(128)
    source:
      field: primary_source_table.columns.b_power_of_attorney
    update_flag: true
  home_phone:
    data_type: VARCHAR(32)
    source:
      field: primary_source_table.columns.b_home_phone
    update_flag: true
  homeownership_education_id:
    data_type: VARCHAR(128)
    source:
      field: primary_source_table.columns.b_homeownership_education_id
    update_flag: true
  homeownership_education_name:
    data_type: VARCHAR(128)
    source:
      field: primary_source_table.columns.b_homeownership_education_name
    update_flag: true
  housing_counseling:
    data_type: VARCHAR(1024)
    source:
      field: primary_source_table.foreign_keys.fkt_b_housing_counseling_type.columns.value
    update_flag: true
  housing_counseling_agency:
    data_type: VARCHAR(1024)
    source:
      field: primary_source_table.foreign_keys.fkt_b_housing_counseling_agency_type.columns.value
    update_flag: true
  housing_counseling_agency_code:
    data_type: VARCHAR(128)
    source:
      field: primary_source_table.columns.b_housing_counseling_agency_type
    update_flag: true
  housing_counseling_code:
    data_type: VARCHAR(128)
    source:
      field: primary_source_table.columns.b_housing_counseling_type
    update_flag: true
  housing_counseling_complete_date:
    source:
      field: primary_source_table.columns.b_housing_counseling_complete_date
    update_flag: true
    data_type: DATE
  housing_counseling_id:
    data_type: VARCHAR(128)
    source:
      field: primary_source_table.columns.b_housing_counseling_id
    update_flag: true
  housing_counseling_name:
    data_type: VARCHAR(128)
    source:
      field: primary_source_table.columns.b_housing_counseling_name
    update_flag: true
  required_to_sign_flag:
    data_type: BOOLEAN
    source:
      field: primary_source_table.columns.b_required_to_sign
    update_flag: true
  last_name:
    data_type: VARCHAR(32)
    source:
      field: primary_source_table.columns.b_last_name
    update_flag: true
  legal_entity:
    data_type: VARCHAR(1024)
    source:
      field: primary_source_table.foreign_keys.fkt_b_legal_entity_type.columns.value
    update_flag: true
  legal_entity_code:
    data_type: VARCHAR(128)
    source:
      field: primary_source_table.columns.b_legal_entity_type
    update_flag: true
  middle_name:
    data_type: VARCHAR(32)
    source:
      field: primary_source_table.columns.b_middle_name
    update_flag: true
  monthly_job_federal_tax_amount:
    data_type: NUMERIC(21,3)
    source:
      field: primary_source_table.columns.b_monthly_job_federal_tax_amount
    update_flag: true
  monthly_job_medicare_tax_amount:
    data_type: NUMERIC(21,3)
    source:
      field: primary_source_table.columns.b_monthly_job_medicare_tax_amount
    update_flag: true
  monthly_job_other_tax_1_amount:
    data_type: NUMERIC(21,3)
    source:
      field: primary_source_table.columns.b_monthly_job_other_tax_1_amount
    update_flag: true
  monthly_job_other_tax_1_description:
    data_type: VARCHAR(128)
    source:
      field: primary_source_table.columns.b_monthly_job_other_tax_1_description
    update_flag: true
  monthly_job_other_tax_2_amount:
    data_type: NUMERIC(21,3)
    source:
      field: primary_source_table.columns.b_monthly_job_other_tax_2_amount
    update_flag: true
  monthly_job_other_tax_2_description:
    data_type: VARCHAR(128)
    source:
      field: primary_source_table.columns.b_monthly_job_other_tax_2_description
    update_flag: true
  monthly_job_other_tax_3_amount:
    data_type: NUMERIC(21,3)
    source:
      field: primary_source_table.columns.b_monthly_job_other_tax_3_amount
    update_flag: true
  monthly_job_other_tax_3_description:
    data_type: VARCHAR(128)
    source:
      field: primary_source_table.columns.b_monthly_job_other_tax_3_description
    update_flag: true
  monthly_job_retirement_tax_amount:
    data_type: NUMERIC(21,3)
    source:
      field: primary_source_table.columns.b_monthly_job_retirement_tax_amount
    update_flag: true
  monthly_job_state_disability_insurance_amount:
    data_type: NUMERIC(21,3)
    source:
      field: primary_source_table.columns.b_monthly_job_state_disability_insurance_amount
    update_flag: true
  monthly_job_state_tax_amount:
    data_type: NUMERIC(21,3)
    source:
      field: primary_source_table.columns.b_monthly_job_state_tax_amount
    update_flag: true
  monthly_job_total_tax_amount:
    data_type: NUMERIC(21,3)
    source:
      field: primary_source_table.columns.b_monthly_job_total_tax_amount
    update_flag: true
  name_suffix:
    data_type: VARCHAR(32)
    source:
      field: primary_source_table.columns.b_name_suffix
    update_flag: true
  nickname:
    data_type: VARCHAR(32)
    source:
      field: primary_source_table.columns.b_nickname
    update_flag: true
  note_endorser_explanation:
    data_type: VARCHAR(128)
    source:
      field: primary_source_table.columns.b_note_endorser_explanation
    update_flag: true
  obligated_loan_foreclosure_explanation:
    data_type: VARCHAR(128)
    source:
      field: primary_source_table.columns.b_obligated_loan_foreclosure_explanation
    update_flag: true
  office_phone:
    data_type: VARCHAR(32)
    source:
      field: primary_source_table.columns.b_office_phone
    update_flag: true
  office_phone_extension:
    data_type: VARCHAR(16)
    source:
      field: primary_source_table.columns.b_office_phone_extension
    update_flag: true
  other_race_national_origin_description:
    data_type: VARCHAR(32)
    source:
      field: primary_source_table.columns.b_other_race_national_origin_description
    update_flag: true
  outstanding_judgments_explanation:
    data_type: VARCHAR(128)
    source:
      field: primary_source_table.columns.b_outstanding_judgments_explanation
    update_flag: true
  party_to_lawsuit_explanation:
    data_type: VARCHAR(128)
    source:
      field: primary_source_table.columns.b_party_to_lawsuit_explanation
    update_flag: true
  power_of_attorney_city:
    data_type: VARCHAR(128)
    source:
      field: primary_source_table.columns.b_power_of_attorney_city
    update_flag: true
  power_of_attorney_company_name:
    data_type: VARCHAR(128)
    source:
      field: primary_source_table.columns.b_power_of_attorney_company_name
    update_flag: true
  power_of_attorney_country:
    data_type: VARCHAR(1024)
    source:
      field: primary_source_table.foreign_keys.fkt_b_power_of_attorney_country.columns.value
    update_flag: true
  power_of_attorney_country_code:
    data_type: VARCHAR(128)
    source:
      field: primary_source_table.columns.b_power_of_attorney_country
    update_flag: true
  power_of_attorney_email:
    data_type: VARCHAR(256)
    source:
      field: primary_source_table.columns.b_power_of_attorney_email
    update_flag: true
  power_of_attorney_fax:
    data_type: VARCHAR(32)
    source:
      field: primary_source_table.columns.b_power_of_attorney_fax
    update_flag: true
  power_of_attorney_first_name:
    data_type: VARCHAR(32)
    source:
      field: primary_source_table.columns.b_power_of_attorney_first_name
    update_flag: true
  power_of_attorney_last_name:
    data_type: VARCHAR(32)
    source:
      field: primary_source_table.columns.b_power_of_attorney_last_name
    update_flag: true
  power_of_attorney_middle_name:
    data_type: VARCHAR(32)
    source:
      field: primary_source_table.columns.b_power_of_attorney_middle_name
    update_flag: true
  power_of_attorney_mobile_phone:
    data_type: VARCHAR(32)
    source:
      field: primary_source_table.columns.b_power_of_attorney_mobile_phone
    update_flag: true
  power_of_attorney_name_suffix:
    data_type: VARCHAR(32)
    source:
      field: primary_source_table.columns.b_power_of_attorney_name_suffix
    update_flag: true
  power_of_attorney_office_phone:
    data_type: VARCHAR(32)
    source:
      field: primary_source_table.columns.b_power_of_attorney_office_phone
    update_flag: true
  power_of_attorney_office_phone_extension:
    data_type: VARCHAR(16)
    source:
      field: primary_source_table.columns.b_power_of_attorney_office_phone_extension
    update_flag: true
  power_of_attorney_postal_code:
    data_type: VARCHAR(128)
    source:
      field: primary_source_table.columns.b_power_of_attorney_postal_code
    update_flag: true
  power_of_attorney_signing_capacity:
    data_type: VARCHAR(1024)
    source:
      field: primary_source_table.columns.b_power_of_attorney_signing_capacity
    update_flag: true
  power_of_attorney_state:
    data_type: VARCHAR(128)
    source:
      field: primary_source_table.columns.b_power_of_attorney_state
    update_flag: true
  power_of_attorney_street1:
    data_type: VARCHAR(128)
    source:
      field: primary_source_table.columns.b_power_of_attorney_street1
    update_flag: true
  power_of_attorney_street2:
    data_type: VARCHAR(128)
    source:
      field: primary_source_table.columns.b_power_of_attorney_street2
    update_flag: true
  power_of_attorney_title:
    data_type: VARCHAR(128)
    source:
      field: primary_source_table.columns.b_power_of_attorney_title
    update_flag: true
  preferred_first_name:
    data_type: VARCHAR(32)
    source:
      field: primary_source_table.columns.b_preferred_first_name
    update_flag: true
  presently_delinquent_explanation:
    data_type: VARCHAR(128)
    source:
      field: primary_source_table.columns.b_presently_delinquent_explanation
    update_flag: true
  prior_property_title:
    data_type: VARCHAR(1024)
    source:
      field: primary_source_table.foreign_keys.fkt_b_prior_property_title_type.columns.value
    update_flag: true
  prior_property_title_code:
    data_type: VARCHAR(128)
    source:
      field: primary_source_table.columns.b_prior_property_title_type
    update_flag: true
  prior_property_usage:
    data_type: VARCHAR(1024)
    source:
      field: primary_source_table.foreign_keys.fkt_b_prior_property_usage_type.columns.value
    update_flag: true
  prior_property_usage_code:
    data_type: VARCHAR(128)
    source:
      field: primary_source_table.columns.b_prior_property_usage_type
    update_flag: true
  property_foreclosure_explanation:
    data_type: VARCHAR(128)
    source:
      field: primary_source_table.columns.b_property_foreclosure_explanation
    update_flag: true
  race_other_american_indian_or_alaska_native_description:
    data_type: VARCHAR(100)
    source:
      field: primary_source_table.columns.b_race_other_american_indian_or_alaska_native_description
    update_flag: true
  race_other_asian_description:
    data_type: VARCHAR(100)
    source:
      field: primary_source_table.columns.b_race_other_asian_description
    update_flag: true
  race_other_pacific_islander_description:
    data_type: VARCHAR(100)
    source:
      field: primary_source_table.columns.b_race_other_pacific_islander_description
    update_flag: true
  relationship_to_primary_borrower:
    data_type: VARCHAR(1024)
    source:
      field: primary_source_table.foreign_keys.fkt_b_relationship_to_primary_borrower_type.columns.value
    update_flag: true
  relationship_to_primary_borrower_code:
    data_type: VARCHAR(128)
    source:
      field: primary_source_table.columns.b_relationship_to_primary_borrower_type
    update_flag: true
  relationship_to_seller:
    data_type: VARCHAR(1024)
    source:
      field: primary_source_table.foreign_keys.fkt_b_relationship_to_seller_type.columns.value
    update_flag: true
  relationship_to_seller_code:
    data_type: VARCHAR(128)
    source:
      field: primary_source_table.columns.b_relationship_to_seller_type
    update_flag: true
  tiny_id:
    data_type: VARCHAR(1024)
    source:
      field: primary_source_table.foreign_keys.fkt_b_borrower_tiny_id_type.columns.value
    update_flag: true
  tiny_id_code:
    data_type: VARCHAR(128)
    source:
      field: primary_source_table.columns.b_borrower_tiny_id_type
    update_flag: true
  trans_union_credit_score:
    data_type: INTEGER
    source:
      field: primary_source_table.columns.b_trans_union_credit_score
    update_flag: true
  usda_annual_child_care_expenses:
    data_type: NUMERIC(21,3)
    source:
      field: primary_source_table.columns.b_usda_annual_child_care_expenses
    update_flag: true
  usda_disability_expenses:
    data_type: NUMERIC(21,3)
    source:
      field: primary_source_table.columns.b_usda_disability_expenses
    update_flag: true
  usda_income_from_assets:
    data_type: NUMERIC(21,3)
    source:
      field: primary_source_table.columns.b_usda_income_from_assets
    update_flag: true
  usda_medical_expenses:
    data_type: NUMERIC(21,3)
    source:
      field: primary_source_table.columns.b_usda_medical_expenses
    update_flag: true
  usda_moderate_income_limit:
    data_type: NUMERIC(21,3)
    source:
      field: primary_source_table.columns.b_usda_moderate_income_limit
    update_flag: true
  current_residence_street1:
    data_type: VARCHAR(128)
    update_flag: true
  current_residence_street2:
    data_type: VARCHAR(128)
    update_flag: true
  current_residence_city:
    data_type: VARCHAR(128)
    update_flag: true
  current_residence_postal_code:
    data_type: VARCHAR(128)
    update_flag: true
  current_residence_county_name:
    data_type: VARCHAR(128)
    update_flag: true
  current_residence_county_fips:
    data_type: VARCHAR(16)
    update_flag: true
  current_residence_state:
    data_type: VARCHAR(128)
    update_flag: true
  current_residence_state_fips:
    data_type: VARCHAR(32)
    update_flag: true
  current_residence_country_code:
    data_type: VARCHAR(128)
    update_flag: true
  current_residence_country:
    data_type: VARCHAR(1024)
    update_flag: true
  borrower_hmda_collection_dwid:
    data_type: BIGINT
    update_flag: true
etls:
  SP-200005-insert-update:
    input_type: table
    output_type: insert_update
    hardcoded_data_source: Octane
    json_output_field: data_source_integration_id
    insert_update_keys:
      - data_source_integration_id
    container_memory: 4096
    input_sql: |-
      WITH borrower_dim_incl_new_records AS (
          SELECT 'borrower_pid' || '~' || 'data_source_dwid' AS data_source_integration_columns
               , COALESCE( CAST( primary_table.b_pid AS TEXT ), '<NULL>' ) || '~' ||
                 COALESCE( CAST( 1 AS TEXT ), '<NULL>' ) AS data_source_integration_id
               , NOW( ) AS edw_created_datetime
               , NOW( ) AS edw_modified_datetime
               , primary_table.data_source_updated_datetime AS data_source_modified_datetime
               , t114.value AS applicant_role
               , t115.value AS application_taken_method
               , primary_table.b_pid AS borrower_pid
               , primary_table.b_alimony_child_support_explanation AS alimony_child_support_explanation
               , primary_table.b_application_taken_method_type AS application_taken_method_code
               , primary_table.b_bankruptcy_explanation AS bankruptcy_explanation
               , primary_table.b_birth_date AS birth_date
               , primary_table.b_borrowed_down_payment_explanation AS borrowed_down_payment_explanation
               , primary_table.b_applicant_role_type AS applicant_role_code
               , primary_table.b_required_to_sign AS required_to_sign_flag
               , primary_table.b_has_no_ssn AS has_no_ssn_flag
               , primary_table.b_credit_report_identifier AS credit_report_identifier
               , primary_table.b_credit_report_authorization AS credit_report_authorization_flag
               , primary_table.b_dependent_count AS dependent_count
               , primary_table.b_dependents_age_years AS dependents_age_years
               , primary_table.b_email AS email
               , primary_table.b_fax AS fax
               , primary_table.b_first_name AS first_name
               , primary_table.b_nickname AS nickname
               , primary_table.b_ethnicity_other_hispanic_or_latino_description AS ethnicity_other_hispanic_or_latino_description
               , primary_table.b_home_phone AS home_phone
               , primary_table.b_last_name AS last_name
               , primary_table.b_middle_name AS middle_name
               , primary_table.b_name_suffix AS name_suffix
               , primary_table.b_note_endorser_explanation AS note_endorser_explanation
               , primary_table.b_obligated_loan_foreclosure_explanation AS obligated_loan_foreclosure_explanation
               , primary_table.b_office_phone AS office_phone
               , primary_table.b_office_phone_extension AS office_phone_extension
               , primary_table.b_other_race_national_origin_description AS other_race_national_origin_description
               , primary_table.b_outstanding_judgments_explanation AS outstanding_judgments_explanation
               , primary_table.b_party_to_lawsuit_explanation AS party_to_lawsuit_explanation
               , primary_table.b_power_of_attorney AS power_of_attorney_code
               , primary_table.b_power_of_attorney_signing_capacity AS power_of_attorney_signing_capacity
               , primary_table.b_power_of_attorney_first_name AS power_of_attorney_first_name
               , primary_table.b_power_of_attorney_last_name AS power_of_attorney_last_name
               , primary_table.b_power_of_attorney_middle_name AS power_of_attorney_middle_name
               , primary_table.b_power_of_attorney_name_suffix AS power_of_attorney_name_suffix
               , primary_table.b_power_of_attorney_company_name AS power_of_attorney_company_name
               , primary_table.b_power_of_attorney_title AS power_of_attorney_title
               , primary_table.b_power_of_attorney_office_phone AS power_of_attorney_office_phone
               , primary_table.b_power_of_attorney_office_phone_extension AS power_of_attorney_office_phone_extension
               , primary_table.b_power_of_attorney_mobile_phone AS power_of_attorney_mobile_phone
               , primary_table.b_power_of_attorney_email AS power_of_attorney_email
               , primary_table.b_power_of_attorney_fax AS power_of_attorney_fax
               , primary_table.b_power_of_attorney_city AS power_of_attorney_city
               , primary_table.b_power_of_attorney_country AS power_of_attorney_country_code
               , primary_table.b_power_of_attorney_postal_code AS power_of_attorney_postal_code
               , primary_table.b_power_of_attorney_state AS power_of_attorney_state
               , primary_table.b_power_of_attorney_street1 AS power_of_attorney_street1
               , primary_table.b_power_of_attorney_street2 AS power_of_attorney_street2
               , primary_table.b_presently_delinquent_explanation AS presently_delinquent_explanation
               , primary_table.b_prior_property_title_type AS prior_property_title_code
               , primary_table.b_prior_property_usage_type AS prior_property_usage_code
               , primary_table.b_property_foreclosure_explanation AS property_foreclosure_explanation
               , primary_table.b_race_other_american_indian_or_alaska_native_description AS race_other_american_indian_or_alaska_native_description
               , primary_table.b_race_other_asian_description AS race_other_asian_description
               , primary_table.b_race_other_pacific_islander_description AS race_other_pacific_islander_description
               , primary_table.b_experian_credit_score AS experian_credit_score
               , primary_table.b_equifax_credit_score AS equifax_credit_score
               , primary_table.b_trans_union_credit_score AS trans_union_credit_score
               , primary_table.b_decision_credit_score AS decision_credit_score
               , primary_table.b_borrower_tiny_id_type AS tiny_id_code
               , primary_table.b_first_time_home_buyer_explain AS first_time_homebuyer_explain
               , primary_table.b_caivrs_id AS caivrs_id
               , primary_table.b_caivrs_messages AS caivrs_messages
               , primary_table.b_monthly_job_federal_tax_amount AS monthly_job_federal_tax_amount
               , primary_table.b_monthly_job_state_tax_amount AS monthly_job_state_tax_amount
               , primary_table.b_monthly_job_retirement_tax_amount AS monthly_job_retirement_tax_amount
               , primary_table.b_monthly_job_medicare_tax_amount AS monthly_job_medicare_tax_amount
               , primary_table.b_monthly_job_state_disability_insurance_amount AS monthly_job_state_disability_insurance_amount
               , primary_table.b_monthly_job_other_tax_1_amount AS monthly_job_other_tax_1_amount
               , primary_table.b_monthly_job_other_tax_1_description AS monthly_job_other_tax_1_description
               , primary_table.b_monthly_job_other_tax_2_amount AS monthly_job_other_tax_2_amount
               , primary_table.b_monthly_job_other_tax_2_description AS monthly_job_other_tax_2_description
               , primary_table.b_monthly_job_other_tax_3_amount AS monthly_job_other_tax_3_amount
               , primary_table.b_monthly_job_other_tax_3_description AS monthly_job_other_tax_3_description
               , primary_table.b_monthly_job_total_tax_amount AS monthly_job_total_tax_amount
               , primary_table.b_homeownership_education_id AS homeownership_education_id
               , primary_table.b_homeownership_education_name AS homeownership_education_name
               , primary_table.b_housing_counseling_type AS housing_counseling_code
               , primary_table.b_housing_counseling_agency_type AS housing_counseling_agency_code
               , primary_table.b_housing_counseling_id AS housing_counseling_id
               , primary_table.b_housing_counseling_name AS housing_counseling_name
               , primary_table.b_housing_counseling_complete_date AS housing_counseling_complete_date
               , primary_table.b_legal_entity_type AS legal_entity_code
               , primary_table.b_credit_report_authorization_datetime AS credit_report_authorization_datetime
               , primary_table.b_credit_report_authorization_method AS credit_report_authorization_method_code
               , primary_table.b_credit_report_authorization_obtained_by_unparsed_name AS credit_report_authorization_obtained_by_unparsed_name
               , primary_table.b_usda_annual_child_care_expenses AS usda_annual_child_care_expenses
               , primary_table.b_usda_disability_expenses AS usda_disability_expenses
               , primary_table.b_usda_medical_expenses AS usda_medical_expenses
               , primary_table.b_usda_income_from_assets AS usda_income_from_assets
               , primary_table.b_usda_moderate_income_limit AS usda_moderate_income_limit
               , primary_table.b_relationship_to_primary_borrower_type AS relationship_to_primary_borrower_code
               , primary_table.b_relationship_to_seller_type AS relationship_to_seller_code
               , primary_table.b_preferred_first_name AS preferred_first_name
               , primary_table.b_application_pid AS application_pid
               , t149.value AS relationship_to_primary_borrower
               , t150.value AS relationship_to_seller
               , t118.value AS tiny_id
               , t142.value AS power_of_attorney_country
               , t120.value AS credit_report_authorization_method
               , t129.value AS housing_counseling_agency
               , t130.value AS housing_counseling
               , t132.value AS legal_entity
               , t144.value AS prior_property_title
               , t145.value AS prior_property_usage
               , t141.value AS power_of_attorney
               , current_borrower_residence_place.pl_street1 AS current_residence_street1
               , current_borrower_residence_place.pl_street2 AS current_residence_street2
               , current_borrower_residence_place.pl_city AS current_residence_city
               , current_borrower_residence_place.pl_postal_code AS current_residence_postal_code
               , county.c_name AS current_residence_county_name
               , current_borrower_residence_place.pl_county_fips AS current_residence_county_fips
               , current_borrower_residence_place.pl_state AS current_residence_state
               , current_borrower_residence_place.pl_state_fips AS current_residence_state_fips
               , current_borrower_residence_place.pl_country AS current_residence_country_code
               , country_type.value AS current_residence_country
               , GREATEST( primary_table.etl_end_date_time, t114.etl_end_date_time, t115.etl_end_date_time, t149.etl_end_date_time,
                           t150.etl_end_date_time, t118.etl_end_date_time, t142.etl_end_date_time, t120.etl_end_date_time, t129.etl_end_date_time,
                           t130.etl_end_date_time, t132.etl_end_date_time, t144.etl_end_date_time, t145.etl_end_date_time,
                           t141.etl_end_date_time, current_borrower_residence.etl_end_date_time,
                           current_borrower_residence_place.etl_end_date_time, county.etl_end_date_time,
                           country_type.etl_end_date_time ) AS max_source_etl_end_date_time
               , COALESCE( CAST( primary_table.b_ethnicity_collected_visual_or_surname AS TEXT ), '<NULL>' ) || '~' ||
                 COALESCE( CAST( primary_table.b_ethnicity_not_obtainable AS TEXT ), '<NULL>' ) || '~' ||
                 COALESCE( CAST( primary_table.b_ethnicity_refused AS TEXT ), '<NULL>' ) || '~' ||
                 COALESCE( CAST( primary_table.b_race_collected_visual_or_surname AS TEXT ), '<NULL>' ) || '~' ||
                 COALESCE( CAST( primary_table.b_race_information_not_provided AS TEXT ), '<NULL>' ) || '~' ||
                 COALESCE( CAST( primary_table.b_race_national_origin_refusal AS TEXT ), '<NULL>' ) || '~' ||
                 COALESCE( CAST( primary_table.b_race_not_obtainable AS TEXT ), '<NULL>' ) || '~' ||
                 COALESCE( CAST( primary_table.b_race_refused AS TEXT ), '<NULL>' ) || '~' ||
                 COALESCE( CAST( primary_table.b_sex_collected_visual_or_surname AS TEXT ), '<NULL>' ) || '~' ||
                 COALESCE( CAST( primary_table.b_sex_not_obtainable AS TEXT ), '<NULL>' ) || '~' ||
                 COALESCE( CAST( primary_table.b_sex_refused AS TEXT ), '<NULL>' ) || '~1' AS borrower_hmda_collection_dim_integration_id
          FROM (
              SELECT <<borrower_partial_load_condition>> AS include_record
                   , borrower.*
                   , etl_log.etl_end_date_time
              FROM history_octane.borrower
              LEFT JOIN history_octane.borrower AS history_records
                        ON borrower.b_pid = history_records.b_pid
                            AND borrower.data_source_updated_datetime < history_records.data_source_updated_datetime
              JOIN star_common.etl_log
                   ON borrower.etl_batch_id = etl_log.etl_batch_id
              WHERE history_records.b_pid IS NULL
          ) AS primary_table
          INNER JOIN (
              SELECT *
              FROM (
                  SELECT <<applicant_role_type_partial_load_condition>> AS include_record
                       , applicant_role_type.*
                       , etl_log.etl_end_date_time
                  FROM history_octane.applicant_role_type
                  LEFT JOIN history_octane.applicant_role_type AS history_records
                            ON applicant_role_type.code = history_records.code
                                AND applicant_role_type.data_source_updated_datetime < history_records.data_source_updated_datetime
                  JOIN star_common.etl_log
                       ON applicant_role_type.etl_batch_id = etl_log.etl_batch_id
                  WHERE history_records.code IS NULL
              ) AS primary_table
          ) AS t114
                     ON primary_table.b_applicant_role_type = t114.code
          INNER JOIN (
              SELECT *
              FROM (
                  SELECT <<application_taken_method_type_partial_load_condition>> AS include_record
                       , application_taken_method_type.*
                       , etl_log.etl_end_date_time
                  FROM history_octane.application_taken_method_type
                  LEFT JOIN history_octane.application_taken_method_type AS history_records
                            ON application_taken_method_type.code = history_records.code
                                AND application_taken_method_type.data_source_updated_datetime < history_records.data_source_updated_datetime
                  JOIN star_common.etl_log
                       ON application_taken_method_type.etl_batch_id = etl_log.etl_batch_id
                  WHERE history_records.code IS NULL
              ) AS primary_table
          ) AS t115
                     ON primary_table.b_application_taken_method_type = t115.code
          INNER JOIN (
              SELECT *
              FROM (
                  SELECT <<borrower_relationship_type_partial_load_condition>> AS include_record
                       , borrower_relationship_type.*
                       , etl_log.etl_end_date_time
                  FROM history_octane.borrower_relationship_type
                  LEFT JOIN history_octane.borrower_relationship_type AS history_records
                            ON borrower_relationship_type.code = history_records.code
                                AND borrower_relationship_type.data_source_updated_datetime < history_records.data_source_updated_datetime
                  JOIN star_common.etl_log
                       ON borrower_relationship_type.etl_batch_id = etl_log.etl_batch_id
                  WHERE history_records.code IS NULL
              ) AS primary_table
          ) AS t149
                     ON primary_table.b_relationship_to_primary_borrower_type = t149.code
          INNER JOIN (
              SELECT *
              FROM (
                  SELECT <<borrower_relationship_type_partial_load_condition>> AS include_record
                       , borrower_relationship_type.*
                       , etl_log.etl_end_date_time
                  FROM history_octane.borrower_relationship_type
                  LEFT JOIN history_octane.borrower_relationship_type AS history_records
                            ON borrower_relationship_type.code = history_records.code
                                AND borrower_relationship_type.data_source_updated_datetime < history_records.data_source_updated_datetime
                  JOIN star_common.etl_log
                       ON borrower_relationship_type.etl_batch_id = etl_log.etl_batch_id
                  WHERE history_records.code IS NULL
              ) AS primary_table
          ) AS t150
                     ON primary_table.b_relationship_to_seller_type = t150.code
          INNER JOIN (
              SELECT *
              FROM (
                  SELECT <<borrower_tiny_id_type_partial_load_condition>> AS include_record
                       , borrower_tiny_id_type.*
                       , etl_log.etl_end_date_time
                  FROM history_octane.borrower_tiny_id_type
                  LEFT JOIN history_octane.borrower_tiny_id_type AS history_records
                            ON borrower_tiny_id_type.code = history_records.code
                                AND borrower_tiny_id_type.data_source_updated_datetime < history_records.data_source_updated_datetime
                  JOIN star_common.etl_log
                       ON borrower_tiny_id_type.etl_batch_id = etl_log.etl_batch_id
                  WHERE history_records.code IS NULL
              ) AS primary_table
          ) AS t118
                     ON primary_table.b_borrower_tiny_id_type = t118.code
          INNER JOIN (
              SELECT *
              FROM (
                  SELECT <<country_type_partial_load_condition>> AS include_record
                       , country_type.*
                       , etl_log.etl_end_date_time
                  FROM history_octane.country_type
                  LEFT JOIN history_octane.country_type AS history_records
                            ON country_type.code = history_records.code
                                AND country_type.data_source_updated_datetime < history_records.data_source_updated_datetime
                  JOIN star_common.etl_log
                       ON country_type.etl_batch_id = etl_log.etl_batch_id
                  WHERE history_records.code IS NULL
              ) AS primary_table
          ) AS t142
                     ON primary_table.b_power_of_attorney_country = t142.code
          INNER JOIN (
              SELECT *
              FROM (
                  SELECT <<credit_authorization_method_type_partial_load_condition>> AS include_record
                       , credit_authorization_method_type.*
                       , etl_log.etl_end_date_time
                  FROM history_octane.credit_authorization_method_type
                  LEFT JOIN history_octane.credit_authorization_method_type AS history_records
                            ON credit_authorization_method_type.code = history_records.code
                                AND credit_authorization_method_type.data_source_updated_datetime < history_records.data_source_updated_datetime
                  JOIN star_common.etl_log
                       ON credit_authorization_method_type.etl_batch_id = etl_log.etl_batch_id
                  WHERE history_records.code IS NULL
              ) AS primary_table
          ) AS t120
                     ON primary_table.b_credit_report_authorization_method = t120.code
          INNER JOIN (
              SELECT *
              FROM (
                  SELECT <<housing_counseling_agency_type_partial_load_condition>> AS include_record
                       , housing_counseling_agency_type.*
                       , etl_log.etl_end_date_time
                  FROM history_octane.housing_counseling_agency_type
                  LEFT JOIN history_octane.housing_counseling_agency_type AS history_records
                            ON housing_counseling_agency_type.code = history_records.code
                                AND housing_counseling_agency_type.data_source_updated_datetime < history_records.data_source_updated_datetime
                  JOIN star_common.etl_log
                       ON housing_counseling_agency_type.etl_batch_id = etl_log.etl_batch_id
                  WHERE history_records.code IS NULL
              ) AS primary_table
          ) AS t129
                     ON primary_table.b_housing_counseling_agency_type = t129.code
          INNER JOIN (
              SELECT *
              FROM (
                  SELECT <<housing_counseling_type_partial_load_condition>> AS include_record
                       , housing_counseling_type.*
                       , etl_log.etl_end_date_time
                  FROM history_octane.housing_counseling_type
                  LEFT JOIN history_octane.housing_counseling_type AS history_records
                            ON housing_counseling_type.code = history_records.code
                                AND housing_counseling_type.data_source_updated_datetime < history_records.data_source_updated_datetime
                  JOIN star_common.etl_log
                       ON housing_counseling_type.etl_batch_id = etl_log.etl_batch_id
                  WHERE history_records.code IS NULL
              ) AS primary_table
          ) AS t130
                     ON primary_table.b_housing_counseling_type = t130.code
          INNER JOIN (
              SELECT *
              FROM (
                  SELECT <<legal_entity_type_partial_load_condition>> AS include_record
                       , legal_entity_type.*
                       , etl_log.etl_end_date_time
                  FROM history_octane.legal_entity_type
                  LEFT JOIN history_octane.legal_entity_type AS history_records
                            ON legal_entity_type.code = history_records.code
                                AND legal_entity_type.data_source_updated_datetime < history_records.data_source_updated_datetime
                  JOIN star_common.etl_log
                       ON legal_entity_type.etl_batch_id = etl_log.etl_batch_id
                  WHERE history_records.code IS NULL
              ) AS primary_table
          ) AS t132
                     ON primary_table.b_legal_entity_type = t132.code
          INNER JOIN (
              SELECT *
              FROM (
                  SELECT <<prior_property_title_type_partial_load_condition>> AS include_record
                       , prior_property_title_type.*
                       , etl_log.etl_end_date_time
                  FROM history_octane.prior_property_title_type
                  LEFT JOIN history_octane.prior_property_title_type AS history_records
                            ON prior_property_title_type.code = history_records.code
                                AND prior_property_title_type.data_source_updated_datetime < history_records.data_source_updated_datetime
                  JOIN star_common.etl_log
                       ON prior_property_title_type.etl_batch_id = etl_log.etl_batch_id
                  WHERE history_records.code IS NULL
              ) AS primary_table
          ) AS t144
                     ON primary_table.b_prior_property_title_type = t144.code
          INNER JOIN (
              SELECT *
              FROM (
                  SELECT <<property_usage_type_partial_load_condition>> AS include_record
                       , property_usage_type.*
                       , etl_log.etl_end_date_time
                  FROM history_octane.property_usage_type
                  LEFT JOIN history_octane.property_usage_type AS history_records
                            ON property_usage_type.code = history_records.code
                                AND property_usage_type.data_source_updated_datetime < history_records.data_source_updated_datetime
                  JOIN star_common.etl_log
                       ON property_usage_type.etl_batch_id = etl_log.etl_batch_id
                  WHERE history_records.code IS NULL
              ) AS primary_table
          ) AS t145
                     ON primary_table.b_prior_property_usage_type = t145.code
          INNER JOIN (
              SELECT *
              FROM (
                  SELECT <<yes_no_unknown_type_partial_load_condition>> AS include_record
                       , yes_no_unknown_type.*
                       , etl_log.etl_end_date_time
                  FROM history_octane.yes_no_unknown_type
                  LEFT JOIN history_octane.yes_no_unknown_type AS history_records
                            ON yes_no_unknown_type.code = history_records.code
                                AND yes_no_unknown_type.data_source_updated_datetime < history_records.data_source_updated_datetime
                  JOIN star_common.etl_log
                       ON yes_no_unknown_type.etl_batch_id = etl_log.etl_batch_id
                  WHERE history_records.code IS NULL
              ) AS primary_table
          ) AS t141
                     ON primary_table.b_power_of_attorney = t141.code
          INNER JOIN (
              SELECT *
              FROM (
                  SELECT <<borrower_residence_partial_load_condition>> AS include_record
                       , borrower_residence.*
                       , etl_log.etl_end_date_time
                  FROM history_octane.borrower_residence
                  LEFT JOIN history_octane.borrower_residence AS history_records
                            ON borrower_residence.bres_pid = history_records.bres_pid
                                AND borrower_residence.data_source_updated_datetime < history_records.data_source_updated_datetime
                  JOIN star_common.etl_log
                       ON borrower_residence.etl_batch_id = etl_log.etl_batch_id
                  WHERE history_records.bres_pid IS NULL
              ) AS primary_table
          ) AS current_borrower_residence
                     ON primary_table.b_pid = current_borrower_residence.bres_borrower_pid
                         AND current_borrower_residence.bres_current IS TRUE
          INNER JOIN (
              SELECT *
              FROM (
                  SELECT <<place_partial_load_condition>> AS include_record
                       , place.*
                       , etl_log.etl_end_date_time
                  FROM history_octane.place
                  LEFT JOIN history_octane.place AS history_records
                            ON place.pl_pid = history_records.pl_pid
                                AND place.data_source_updated_datetime < history_records.data_source_updated_datetime
                  JOIN star_common.etl_log
                       ON place.etl_batch_id = etl_log.etl_batch_id
                  WHERE history_records.pl_pid IS NULL
              ) AS primary_table
          ) AS current_borrower_residence_place
                     ON current_borrower_residence.bres_place_pid = current_borrower_residence_place.pl_pid
          INNER JOIN (
              SELECT *
              FROM (
                  SELECT <<county_partial_load_condition>> AS include_record
                       , county.*
                       , etl_log.etl_end_date_time
                  FROM history_octane.county
                  LEFT JOIN history_octane.county AS history_records
                            ON county.c_pid = history_records.c_pid
                                AND county.data_source_updated_datetime < history_records.data_source_updated_datetime
                  JOIN star_common.etl_log
                       ON county.etl_batch_id = etl_log.etl_batch_id
                  WHERE history_records.c_pid IS NULL
              ) AS primary_table
          ) AS county
                     ON current_borrower_residence_place.pl_county_pid = county.c_pid
          INNER JOIN (
              SELECT *
              FROM (
                  SELECT <<country_type_partial_load_condition>> AS include_record
                       , country_type.*
                       , etl_log.etl_end_date_time
                  FROM history_octane.country_type
                  LEFT JOIN history_octane.country_type AS history_records
                            ON country_type.code = history_records.code
                                AND country_type.data_source_updated_datetime < history_records.data_source_updated_datetime
                  JOIN star_common.etl_log
                       ON country_type.etl_batch_id = etl_log.etl_batch_id
                  WHERE history_records.code IS NULL
              ) AS primary_table
          ) AS country_type
                     ON current_borrower_residence_place.pl_country = country_type.code
          WHERE GREATEST( primary_table.include_record, t114.include_record, t115.include_record, t149.include_record, t150.include_record,
                          t118.include_record, t142.include_record, t120.include_record, t129.include_record, t130.include_record,
                          t132.include_record, t144.include_record, t145.include_record, t141.include_record,
                          current_borrower_residence.include_record, current_borrower_residence_place.include_record,
                          county.include_record, country_type.include_record ) IS TRUE
      )
         , borrower_dim_inserts_and_updates AS (
      --new records that should be inserted
          SELECT borrower_dim_incl_new_records.*
          FROM borrower_dim_incl_new_records
          LEFT JOIN star_loan.borrower_dim
                    ON borrower_dim_incl_new_records.data_source_integration_id = borrower_dim.data_source_integration_id
          WHERE borrower_dim.dwid IS NULL
          UNION ALL
      --existing records that need to be updated
          SELECT borrower_dim_incl_new_records.*
          FROM borrower_dim_incl_new_records
          JOIN (
              SELECT borrower_dim.data_source_integration_id, etl_log.etl_start_date_time
              FROM star_loan.borrower_dim
              JOIN star_common.etl_log
                   ON borrower_dim.etl_batch_id = etl_log.etl_batch_id
          ) AS borrower_dim_etl_start_times
               ON borrower_dim_incl_new_records.data_source_integration_id = borrower_dim_etl_start_times.data_source_integration_id
                   AND borrower_dim_incl_new_records.max_source_etl_end_date_time >= borrower_dim_etl_start_times.etl_start_date_time
      )
      SELECT borrower_dim_inserts_and_updates.*
           , COALESCE( borrower_hmda_collection_dim.dwid, 0 ) AS borrower_hmda_collection_dwid
      FROM borrower_dim_inserts_and_updates
      LEFT JOIN star_loan.borrower_hmda_collection_dim
                ON borrower_dim_inserts_and_updates.borrower_hmda_collection_dim_integration_id =
                   borrower_hmda_collection_dim.data_source_integration_id;
  SP-200005-update:
    input_type: table
    output_type: insert_update
    hardcoded_data_source: Octane
    json_output_field: data_source_integration_id
    insert_update_keys:
    - data_source_integration_id
    container_memory: 4096
    input_sql: |-
      --SP-200005-update
      SELECT borrower_dim.data_source_integration_columns
           , borrower_dim.data_source_integration_id
           , borrower_dim.edw_created_datetime
           , NOW( ) AS edw_modified_datetime
           , borrower_dim.data_source_modified_datetime
           , borrower_dim.applicant_role
           , borrower_dim.application_taken_method
           , borrower_dim.borrower_pid
           , borrower_dim.alimony_child_support_explanation
           , borrower_dim.application_taken_method_code
           , borrower_dim.bankruptcy_explanation
           , borrower_dim.birth_date
           , borrower_dim.borrowed_down_payment_explanation
           , borrower_dim.applicant_role_code
           , borrower_dim.required_to_sign_flag
           , borrower_dim.has_no_ssn_flag
           , borrower_dim.credit_report_identifier
           , borrower_dim.credit_report_authorization_flag
           , borrower_dim.dependent_count
           , borrower_dim.dependents_age_years
           , borrower_dim.email
           , borrower_dim.fax
           , borrower_dim.first_name
           , borrower_dim.nickname
           , borrower_dim.ethnicity_other_hispanic_or_latino_description
           , borrower_dim.home_phone
           , borrower_dim.last_name
           , borrower_dim.middle_name
           , borrower_dim.name_suffix
           , borrower_dim.note_endorser_explanation
           , borrower_dim.obligated_loan_foreclosure_explanation
           , borrower_dim.office_phone
           , borrower_dim.office_phone_extension
           , borrower_dim.other_race_national_origin_description
           , borrower_dim.outstanding_judgments_explanation
           , borrower_dim.party_to_lawsuit_explanation
           , borrower_dim.power_of_attorney_code
           , borrower_dim.power_of_attorney_signing_capacity
           , borrower_dim.power_of_attorney_first_name
           , borrower_dim.power_of_attorney_last_name
           , borrower_dim.power_of_attorney_middle_name
           , borrower_dim.power_of_attorney_name_suffix
           , borrower_dim.power_of_attorney_company_name
           , borrower_dim.power_of_attorney_title
           , borrower_dim.power_of_attorney_office_phone
           , borrower_dim.power_of_attorney_office_phone_extension
           , borrower_dim.power_of_attorney_mobile_phone
           , borrower_dim.power_of_attorney_email
           , borrower_dim.power_of_attorney_fax
           , borrower_dim.power_of_attorney_city
           , borrower_dim.power_of_attorney_country_code
           , borrower_dim.power_of_attorney_postal_code
           , borrower_dim.power_of_attorney_state
           , borrower_dim.power_of_attorney_street1
           , borrower_dim.power_of_attorney_street2
           , borrower_dim.presently_delinquent_explanation
           , borrower_dim.prior_property_title_code
           , borrower_dim.prior_property_usage_code
           , borrower_dim.property_foreclosure_explanation
           , borrower_dim.race_other_american_indian_or_alaska_native_description
           , borrower_dim.race_other_asian_description
           , borrower_dim.race_other_pacific_islander_description
           , borrower_dim.experian_credit_score
           , borrower_dim.equifax_credit_score
           , borrower_dim.trans_union_credit_score
           , borrower_dim.decision_credit_score
           , borrower_dim.tiny_id_code
           , borrower_dim.first_time_homebuyer_explain
           , borrower_dim.caivrs_id
           , borrower_dim.caivrs_messages
           , borrower_dim.monthly_job_federal_tax_amount
           , borrower_dim.monthly_job_state_tax_amount
           , borrower_dim.monthly_job_retirement_tax_amount
           , borrower_dim.monthly_job_medicare_tax_amount
           , borrower_dim.monthly_job_state_disability_insurance_amount
           , borrower_dim.monthly_job_other_tax_1_amount
           , borrower_dim.monthly_job_other_tax_1_description
           , borrower_dim.monthly_job_other_tax_2_amount
           , borrower_dim.monthly_job_other_tax_2_description
           , borrower_dim.monthly_job_other_tax_3_amount
           , borrower_dim.monthly_job_other_tax_3_description
           , borrower_dim.monthly_job_total_tax_amount
           , borrower_dim.homeownership_education_id
           , borrower_dim.homeownership_education_name
           , borrower_dim.housing_counseling_code
           , borrower_dim.housing_counseling_agency_code
           , borrower_dim.housing_counseling_id
           , borrower_dim.housing_counseling_name
           , borrower_dim.housing_counseling_complete_date
           , borrower_dim.legal_entity_code
           , borrower_dim.credit_report_authorization_datetime
           , borrower_dim.credit_report_authorization_method_code
           , borrower_dim.credit_report_authorization_obtained_by_unparsed_name
           , borrower_dim.usda_annual_child_care_expenses
           , borrower_dim.usda_disability_expenses
           , borrower_dim.usda_medical_expenses
           , borrower_dim.usda_income_from_assets
           , borrower_dim.usda_moderate_income_limit
           , borrower_dim.relationship_to_primary_borrower_code
           , borrower_dim.relationship_to_seller_code
           , borrower_dim.preferred_first_name
           , borrower_dim.application_pid
           , borrower_dim.relationship_to_primary_borrower
           , borrower_dim.relationship_to_seller
           , borrower_dim.tiny_id
           , borrower_dim.power_of_attorney_country
           , borrower_dim.credit_report_authorization_method
           , borrower_dim.housing_counseling_agency
           , borrower_dim.housing_counseling
           , borrower_dim.legal_entity
           , borrower_dim.prior_property_title
           , borrower_dim.prior_property_usage
           , borrower_dim.power_of_attorney
           , borrower_dim.current_residence_street1
           , borrower_dim.current_residence_street2
           , borrower_dim.current_residence_city
           , borrower_dim.current_residence_postal_code
           , borrower_dim.current_residence_county_name
           , borrower_dim.current_residence_county_fips
           , borrower_dim.current_residence_state
           , borrower_dim.current_residence_state_fips
           , borrower_dim.current_residence_country_code
           , borrower_dim.current_residence_country
           , borrower_hmda_collection_dim.dwid AS borrower_hmda_collection_dwid
      FROM star_loan.borrower_dim
      JOIN (
          SELECT borrower.*
               , COALESCE( CAST( borrower.b_ethnicity_collected_visual_or_surname AS TEXT ), '<NULL>' ) || '~' ||
                 COALESCE( CAST( borrower.b_ethnicity_not_obtainable AS TEXT ), '<NULL>' ) || '~' ||
                 COALESCE( CAST( borrower.b_ethnicity_refused AS TEXT ), '<NULL>' ) || '~' ||
                 COALESCE( CAST( borrower.b_race_collected_visual_or_surname AS TEXT ), '<NULL>' ) || '~' ||
                 COALESCE( CAST( borrower.b_race_information_not_provided AS TEXT ), '<NULL>' ) || '~' ||
                 COALESCE( CAST( borrower.b_race_national_origin_refusal AS TEXT ), '<NULL>' ) || '~' ||
                 COALESCE( CAST( borrower.b_race_not_obtainable AS TEXT ), '<NULL>' ) || '~' ||
                 COALESCE( CAST( borrower.b_race_refused AS TEXT ), '<NULL>' ) || '~' ||
                 COALESCE( CAST( borrower.b_sex_collected_visual_or_surname AS TEXT ), '<NULL>' ) || '~' ||
                 COALESCE( CAST( borrower.b_sex_not_obtainable AS TEXT ), '<NULL>' ) || '~' ||
                 COALESCE( CAST( borrower.b_sex_refused AS TEXT ), '<NULL>' ) || '~1' AS borrower_hmda_collection_dim_integration_id
          FROM history_octane.borrower
          LEFT JOIN history_octane.borrower AS history_records
                    ON borrower.b_pid = history_records.b_pid
                        AND borrower.data_source_updated_datetime < history_records.data_source_updated_datetime
          WHERE history_records.b_pid IS NULL
      ) AS borrower
           ON borrower_dim.borrower_pid = borrower.b_pid
      JOIN star_loan.borrower_hmda_collection_dim
           ON borrower.borrower_hmda_collection_dim_integration_id = borrower_hmda_collection_dim.data_source_integration_id
      WHERE borrower_dim.borrower_hmda_collection_dwid = 0;
next_etls:
  - SP-300001-insert-update
