name: interim_funder_dim
primary_source_table: staging.history_octane.interim_funder
primary_key:
- dwid
columns:
  dwid:
    data_type: BIGINT
    update_flag: false
  data_source_dwid:
    data_type: BIGINT
    update_flag: false
  edw_created_datetime:
    data_type: TIMESTAMPTZ
    update_flag: false
  edw_modified_datetime:
    data_type: TIMESTAMPTZ
    update_flag: true
  etl_batch_id:
    data_type: TEXT
    update_flag: true
  data_source_integration_columns:
    data_type: TEXT
    update_flag: false
  data_source_integration_id:
    data_type: TEXT
    update_flag: false
  data_source_modified_datetime:
    data_type: TIMESTAMPTZ
    update_flag: true
  interim_funder_pid:
    data_type: BIGINT
    source:
      field: primary_source_table.columns.if_pid
    update_flag: false
  address_city:
    data_type: VARCHAR(128)
    source:
      field: primary_source_table.columns.if_company_address_city
    update_flag: true
  address_country:
    data_type: VARCHAR(1024)
    source:
      field: primary_source_table.foreign_keys.fkt_if_company_address_country.columns.value
    update_flag: true
  address_country_code:
    data_type: VARCHAR(128)
    source:
      field: primary_source_table.columns.if_company_address_country
    update_flag: true
  address_postal_code:
    data_type: VARCHAR(128)
    source:
      field: primary_source_table.columns.if_company_address_postal_code
    update_flag: true
  address_state:
    data_type: VARCHAR(128)
    source:
      field: primary_source_table.columns.if_company_address_state
    update_flag: true
  address_street1:
    data_type: VARCHAR(128)
    source:
      field: primary_source_table.columns.if_company_address_street1
    update_flag: true
  address_street2:
    data_type: VARCHAR(128)
    source:
      field: primary_source_table.columns.if_company_address_street2
    update_flag: true
  contact_unparsed_name:
    data_type: VARCHAR(128)
    source:
      field: primary_source_table.columns.if_company_contact_unparsed_name
    update_flag: true
  email:
    data_type: VARCHAR(256)
    source:
      field: primary_source_table.columns.if_company_email
    update_flag: true
  fax:
    data_type: VARCHAR(32)
    source:
      field: primary_source_table.columns.if_company_fax
    update_flag: true
  fnm_payee_id:
    data_type: VARCHAR(9)
    source:
      field: primary_source_table.columns.if_fnm_payee_id
    update_flag: true
  fnm_warehouse_lender_id:
    data_type: VARCHAR(32)
    source:
      field: primary_source_table.columns.if_fnm_warehouse_lender_id
    update_flag: true
  fre_warehouse_lender_id:
    data_type: VARCHAR(32)
    source:
      field: primary_source_table.columns.if_fre_warehouse_lender_id
    update_flag: true
  id:
    data_type: VARCHAR(32)
    source:
      field: primary_source_table.columns.if_funder_id
    update_flag: true
  mers_org_id:
    data_type: VARCHAR(7)
    source:
      field: primary_source_table.columns.if_company_mers_org_id
    update_flag: true
  mers_registration:
    data_type: VARCHAR(1024)
    source:
      field: primary_source_table.foreign_keys.fkt_if_interim_funder_mers_registration_type.columns.value
    update_flag: true
  mers_registration_code:
    data_type: VARCHAR(128)
    source:
      field: primary_source_table.columns.if_interim_funder_mers_registration_type
    update_flag: true
  name:
    data_type: VARCHAR(128)
    source:
      field: primary_source_table.columns.if_company_name
    update_flag: true
  office_phone:
    data_type: VARCHAR(32)
    source:
      field: primary_source_table.columns.if_company_office_phone
    update_flag: true
  office_phone_extension:
    data_type: VARCHAR(16)
    source:
      field: primary_source_table.columns.if_company_office_phone_extension
    update_flag: true
  reimbursement_wire_attention_unparsed_name:
    data_type: VARCHAR(128)
    source:
      field: primary_source_table.columns.if_reimbursement_wire_attention_unparsed_name
    update_flag: true
  reimbursement_wire_authorized_signer_unparsed_name:
    data_type: VARCHAR(128)
    source:
      field: primary_source_table.columns.if_reimbursement_wire_authorized_signer_unparsed_name
    update_flag: true
  remarks:
    data_type: VARCHAR(1024)
    source:
      field: primary_source_table.columns.if_remarks
    update_flag: true
  remibursement_wire_credit_to_name:
    data_type: VARCHAR(128)
    source:
      field: primary_source_table.columns.if_reimbursement_wire_credit_to_name
    update_flag: true
  return_wire_attention_unparsed_name:
    data_type: VARCHAR(128)
    source:
      field: primary_source_table.columns.if_return_wire_attention_unparsed_name
    update_flag: true
  return_wire_authorized_signer_unparsed_name:
    data_type: VARCHAR(128)
    source:
      field: primary_source_table.columns.if_return_wire_authorized_signer_unparsed_name
    update_flag: true
  return_wire_credit_to_name:
    data_type: VARCHAR(128)
    source:
      field: primary_source_table.columns.if_return_wire_credit_to_name
    update_flag: true
  from_date:
    data_type: DATE
    source:
      field: primary_source_table.columns.if_from_date
    update_flag: true
  through_date:
    data_type: DATE
    source:
      field: primary_source_table.columns.if_through_date
    update_flag: true
etls:
  SP-200008:
    input_type: table
    output_type: insert_update
    hardcoded_data_source: Octane
    json_output_field: data_source_integration_id
    insert_update_keys:
      - data_source_integration_id
    input_sql: |-
      SELECT interim_funder_dim_incl_new_records.data_source_integration_columns
          , interim_funder_dim_incl_new_records.data_source_integration_id
          , interim_funder_dim_incl_new_records.edw_created_datetime
          , interim_funder_dim_incl_new_records.edw_modified_datetime
          , interim_funder_dim_incl_new_records.data_source_modified_datetime
          , interim_funder_dim_incl_new_records.address_country
          , interim_funder_dim_incl_new_records.interim_funder_pid
          , interim_funder_dim_incl_new_records.name
          , interim_funder_dim_incl_new_records.contact_unparsed_name
          , interim_funder_dim_incl_new_records.address_street1
          , interim_funder_dim_incl_new_records.address_street2
          , interim_funder_dim_incl_new_records.address_city
          , interim_funder_dim_incl_new_records.address_state
          , interim_funder_dim_incl_new_records.address_postal_code
          , interim_funder_dim_incl_new_records.address_country_code
          , interim_funder_dim_incl_new_records.office_phone
          , interim_funder_dim_incl_new_records.office_phone_extension
          , interim_funder_dim_incl_new_records.email
          , interim_funder_dim_incl_new_records.fax
          , interim_funder_dim_incl_new_records.mers_org_id
          , interim_funder_dim_incl_new_records.remarks
          , interim_funder_dim_incl_new_records.from_date
          , interim_funder_dim_incl_new_records.through_date
          , interim_funder_dim_incl_new_records.remibursement_wire_credit_to_name
          , interim_funder_dim_incl_new_records.reimbursement_wire_attention_unparsed_name
          , interim_funder_dim_incl_new_records.reimbursement_wire_authorized_signer_unparsed_name
          , interim_funder_dim_incl_new_records.return_wire_credit_to_name
          , interim_funder_dim_incl_new_records.return_wire_authorized_signer_unparsed_name
          , interim_funder_dim_incl_new_records.fnm_payee_id
          , interim_funder_dim_incl_new_records.mers_registration_code
          , interim_funder_dim_incl_new_records.fnm_warehouse_lender_id
          , interim_funder_dim_incl_new_records.fre_warehouse_lender_id
          , interim_funder_dim_incl_new_records.id
          , interim_funder_dim_incl_new_records.return_wire_attention_unparsed_name
          , interim_funder_dim_incl_new_records.mers_registration

      FROM (
      SELECT 'interim_funder_pid' || '~' || 'data_source_dwid' as data_source_integration_columns,
              COALESCE(CAST(primary_table.if_pid as text), '<NULL>')  || '~' || COALESCE(CAST(1 as text), '<NULL>')  as data_source_integration_id,
              now() as edw_created_datetime,
              now() as edw_modified_datetime,
              primary_table.data_source_updated_datetime as data_source_modified_datetime,
              t309.value as address_country,
              primary_table.if_pid as interim_funder_pid,
              primary_table.if_company_name as name,
              primary_table.if_company_contact_unparsed_name as contact_unparsed_name,
              primary_table.if_company_address_street1 as address_street1,
              primary_table.if_company_address_street2 as address_street2,
              primary_table.if_company_address_city as address_city,
              primary_table.if_company_address_state as address_state,
              primary_table.if_company_address_postal_code as address_postal_code,
              primary_table.if_company_address_country as address_country_code,
              primary_table.if_company_office_phone as office_phone,
              primary_table.if_company_office_phone_extension as office_phone_extension,
              primary_table.if_company_email as email,
              primary_table.if_company_fax as fax,
              primary_table.if_company_mers_org_id as mers_org_id,
              primary_table.if_remarks as remarks,
              primary_table.if_from_date as from_date,
              primary_table.if_through_date as through_date,
              primary_table.if_reimbursement_wire_credit_to_name as remibursement_wire_credit_to_name,
              primary_table.if_reimbursement_wire_attention_unparsed_name as reimbursement_wire_attention_unparsed_name,
              primary_table.if_reimbursement_wire_authorized_signer_unparsed_name as reimbursement_wire_authorized_signer_unparsed_name,
              primary_table.if_return_wire_credit_to_name as return_wire_credit_to_name,
              primary_table.if_return_wire_authorized_signer_unparsed_name as return_wire_authorized_signer_unparsed_name,
              primary_table.if_fnm_payee_id as fnm_payee_id,
              primary_table.if_interim_funder_mers_registration_type as mers_registration_code,
              primary_table.if_fnm_warehouse_lender_id as fnm_warehouse_lender_id,
              primary_table.if_fre_warehouse_lender_id as fre_warehouse_lender_id,
              primary_table.if_funder_id as id,
              primary_table.if_return_wire_attention_unparsed_name as return_wire_attention_unparsed_name,
              t310.value as mers_registration
       FROM (
          SELECT
              <<interim_funder_partial_load_condition>> as include_record,
              interim_funder.*
          FROM history_octane.interim_funder
              LEFT JOIN history_octane.interim_funder AS history_records ON interim_funder.if_pid = history_records.if_pid
                  AND interim_funder.data_source_updated_datetime < history_records.data_source_updated_datetime
          WHERE history_records.if_pid IS NULL
          ) AS primary_table

          INNER JOIN (
              SELECT * FROM (
                  SELECT     <<country_type_partial_load_condition>> as include_record,
                  country_type.*
                  FROM history_octane.country_type
                      LEFT JOIN history_octane.country_type AS history_records ON country_type.code = history_records.code
                      AND country_type.data_source_updated_datetime < history_records.data_source_updated_datetime
                  WHERE history_records.code IS NULL
              ) as primary_table

          ) AS t309 ON primary_table.if_company_address_country = t309.code

          INNER JOIN (
              SELECT * FROM (
                  SELECT     <<interim_funder_mers_registration_type_partial_load_condition>> as include_record,
                  interim_funder_mers_registration_type.*
                  FROM history_octane.interim_funder_mers_registration_type
                      LEFT JOIN history_octane.interim_funder_mers_registration_type AS history_records ON interim_funder_mers_registration_type.code = history_records.code
                      AND interim_funder_mers_registration_type.data_source_updated_datetime < history_records.data_source_updated_datetime
                  WHERE history_records.code IS NULL
              ) as primary_table

          ) AS t310 ON primary_table.if_interim_funder_mers_registration_type = t310.code
       WHERE
          GREATEST(primary_table.include_record, t309.include_record, t310.include_record) IS TRUE
       ORDER BY
          primary_table.data_source_updated_datetime ASC
      ) AS interim_funder_dim_incl_new_records
          LEFT JOIN star_loan.interim_funder_dim ON interim_funder_dim_incl_new_records.data_source_integration_id =
                                                interim_funder_dim.data_source_integration_id
              AND interim_funder_dim_incl_new_records.address_city IS NOT DISTINCT FROM interim_funder_dim.address_city
              AND interim_funder_dim_incl_new_records.address_country IS NOT DISTINCT FROM interim_funder_dim.address_country
              AND interim_funder_dim_incl_new_records.address_country_code IS NOT DISTINCT FROM interim_funder_dim.address_country_code
              AND interim_funder_dim_incl_new_records.address_postal_code IS NOT DISTINCT FROM interim_funder_dim.address_postal_code
              AND interim_funder_dim_incl_new_records.address_state IS NOT DISTINCT FROM interim_funder_dim.address_state
              AND interim_funder_dim_incl_new_records.address_street1 IS NOT DISTINCT FROM interim_funder_dim.address_street1
              AND interim_funder_dim_incl_new_records.address_street2 IS NOT DISTINCT FROM interim_funder_dim.address_street2
              AND interim_funder_dim_incl_new_records.contact_unparsed_name IS NOT DISTINCT FROM interim_funder_dim.contact_unparsed_name
              AND interim_funder_dim_incl_new_records.email IS NOT DISTINCT FROM interim_funder_dim.email
              AND interim_funder_dim_incl_new_records.fax IS NOT DISTINCT FROM interim_funder_dim.fax
              AND interim_funder_dim_incl_new_records.fnm_payee_id IS NOT DISTINCT FROM interim_funder_dim.fnm_payee_id
              AND interim_funder_dim_incl_new_records.fnm_warehouse_lender_id IS NOT DISTINCT FROM interim_funder_dim.fnm_warehouse_lender_id
              AND interim_funder_dim_incl_new_records.fre_warehouse_lender_id IS NOT DISTINCT FROM interim_funder_dim.fre_warehouse_lender_id
              AND interim_funder_dim_incl_new_records.id IS NOT DISTINCT FROM interim_funder_dim.id
              AND interim_funder_dim_incl_new_records.mers_org_id IS NOT DISTINCT FROM interim_funder_dim.mers_org_id
              AND interim_funder_dim_incl_new_records.mers_registration IS NOT DISTINCT FROM interim_funder_dim.mers_registration
              AND interim_funder_dim_incl_new_records.mers_registration_code IS NOT DISTINCT FROM interim_funder_dim.mers_registration_code
              AND interim_funder_dim_incl_new_records.name IS NOT DISTINCT FROM interim_funder_dim.name
              AND interim_funder_dim_incl_new_records.office_phone IS NOT DISTINCT FROM interim_funder_dim.office_phone
              AND interim_funder_dim_incl_new_records.office_phone_extension IS NOT DISTINCT FROM interim_funder_dim.office_phone_extension
              AND interim_funder_dim_incl_new_records.reimbursement_wire_attention_unparsed_name IS NOT DISTINCT FROM interim_funder_dim
                  .reimbursement_wire_attention_unparsed_name
              AND interim_funder_dim_incl_new_records.reimbursement_wire_authorized_signer_unparsed_name IS NOT DISTINCT FROM
                  interim_funder_dim.reimbursement_wire_authorized_signer_unparsed_name
              AND interim_funder_dim_incl_new_records.remarks IS NOT DISTINCT FROM interim_funder_dim.remarks
              AND interim_funder_dim_incl_new_records.remibursement_wire_credit_to_name IS NOT DISTINCT FROM interim_funder_dim
                  .remibursement_wire_credit_to_name
              AND interim_funder_dim_incl_new_records.return_wire_attention_unparsed_name IS NOT DISTINCT FROM interim_funder_dim
                  .return_wire_attention_unparsed_name
              AND interim_funder_dim_incl_new_records.return_wire_authorized_signer_unparsed_name IS NOT DISTINCT FROM interim_funder_dim
                  .return_wire_authorized_signer_unparsed_name
              AND interim_funder_dim_incl_new_records.return_wire_credit_to_name IS NOT DISTINCT FROM interim_funder_dim
                  .return_wire_credit_to_name
              AND interim_funder_dim_incl_new_records.from_date IS NOT DISTINCT FROM interim_funder_dim.from_date
              AND interim_funder_dim_incl_new_records.through_date IS NOT DISTINCT FROM interim_funder_dim.through_date
      WHERE interim_funder_dim.dwid IS NULL;
next_etls:
  - SP-300001-insert-update
