name: borrower_lending_profile_dim
primary_source_table: staging.history_octane.borrower
primary_key:
- dwid
columns:
  dwid:
    data_type: BIGINT
    update_flag: false
  data_source_dwid:
    data_type: BIGINT
    update_flag: false
  edw_created_datetime:
    data_type: TIMESTAMPTZ
    update_flag: false
  edw_modified_datetime:
    data_type: TIMESTAMPTZ
    update_flag: true
  etl_batch_id:
    data_type: TEXT
    update_flag: true
  data_source_integration_columns:
    data_type: TEXT
    update_flag: true
  data_source_integration_id:
    data_type: TEXT
    update_flag: false
  data_source_modified_datetime:
    data_type: TIMESTAMPTZ
    update_flag: false
  alimony_child_support:
    data_type: VARCHAR(1024)
    source:
      field: primary_source_table.foreign_keys.fkt_b_alimony_child_support.columns.value
    update_flag: true
  alimony_child_support_code:
    data_type: VARCHAR(128)
    source:
      field: primary_source_table.columns.b_alimony_child_support
    update_flag: false
  bankruptcy:
    data_type: VARCHAR(1024)
    source:
      field: primary_source_table.foreign_keys.fkt_b_bankruptcy.columns.value
    update_flag: true
  bankruptcy_code:
    data_type: VARCHAR(128)
    source:
      field: primary_source_table.columns.b_bankruptcy
    update_flag: false
  borrowed_down_payment:
    data_type: VARCHAR(1024)
    source:
      field: primary_source_table.foreign_keys.fkt_b_borrowed_down_payment.columns.value
    update_flag: true
  borrowed_down_payment_code:
    data_type: VARCHAR(128)
    source:
      field: primary_source_table.columns.b_borrowed_down_payment
    update_flag: false
  citizenship_residency:
    data_type: VARCHAR(1024)
    source:
      field: primary_source_table.foreign_keys.fkt_b_citizenship_residency_type.columns.value
    update_flag: true
  citizenship_residency_code:
    data_type: VARCHAR(128)
    source:
      field: primary_source_table.columns.b_citizenship_residency_type
    update_flag: false
  disabled:
    data_type: VARCHAR(1024)
    source:
      field: primary_source_table.foreign_keys.fkt_b_disabled.columns.value
    update_flag: true
  disabled_code:
    data_type: VARCHAR(128)
    source:
      field: primary_source_table.columns.b_disabled
    update_flag: false
  domestic_relationship_state:
    data_type: VARCHAR(1024)
    source:
      field: primary_source_table.foreign_keys.fkt_b_domestic_relationship_state_type.columns.value
    update_flag: true
  domestic_relationship_state_code:
    data_type: VARCHAR(128)
    source:
      field: primary_source_table.columns.b_domestic_relationship_state_type
    update_flag: false
  dependents:
    data_type: VARCHAR(1024)
    source:
      field: primary_source_table.foreign_keys.fkt_b_has_dependents.columns.value
    update_flag: true
  dependents_code:
    data_type: VARCHAR(128)
    source:
      field: primary_source_table.columns.b_has_dependents
    update_flag: false
  homeowner_past_three_years:
    data_type: VARCHAR(1024)
    source:
      field: primary_source_table.foreign_keys.fkt_b_homeowner_past_three_years.columns.value
    update_flag: true
  homeowner_past_three_years_code:
    data_type: VARCHAR(128)
    source:
      field: primary_source_table.columns.b_homeowner_past_three_years
    update_flag: false
  homeownership_education:
    data_type: VARCHAR(1024)
    source:
      field: primary_source_table.foreign_keys.fkt_b_homeownership_education_type.columns.value
    update_flag: true
  homeownership_education_agency:
    data_type: VARCHAR(1024)
    source:
      field: primary_source_table.foreign_keys.fkt_b_homeownership_education_agency_type.columns.value
    update_flag: true
  homeownership_education_agency_code:
    data_type: VARCHAR(128)
    source:
      field: primary_source_table.columns.b_homeownership_education_agency_type
    update_flag: false
  homeownership_education_code:
    data_type: VARCHAR(128)
    source:
      field: primary_source_table.columns.b_homeownership_education_type
    update_flag: false
  intend_to_occupy:
    data_type: VARCHAR(1024)
    source:
      field: primary_source_table.foreign_keys.fkt_b_intend_to_occupy.columns.value
    update_flag: true
  intend_to_occupy_code:
    data_type: VARCHAR(128)
    source:
      field: primary_source_table.columns.b_intend_to_occupy
    update_flag: false
  first_time_homebuyer_flag:
    data_type: BOOLEAN
    source:
      field: primary_source_table.columns.b_first_time_homebuyer
    update_flag: false
  first_time_homebuyer_auto_compute_flag:
    data_type: BOOLEAN
    source:
      field: primary_source_table.columns.b_first_time_home_buyer_auto_compute
    update_flag: false
  hud_employee_flag:
    data_type: BOOLEAN
    source:
      field: primary_source_table.columns.b_hud_employee
    update_flag: false
  lender_employee_status_confirmed_flag:
    data_type: BOOLEAN
    source:
      field: primary_source_table.columns.b_lender_employee_status_confirmed
    update_flag: false
  lender_employee:
    data_type: VARCHAR(1024)
    source:
      field: primary_source_table.foreign_keys.fkt_b_lender_employee.columns.value
    update_flag: true
  lender_employee_code:
    data_type: VARCHAR(128)
    source:
      field: primary_source_table.columns.b_lender_employee
    update_flag: false
  note_endorser:
    data_type: VARCHAR(1024)
    source:
      field: primary_source_table.foreign_keys.fkt_b_note_endorser.columns.value
    update_flag: true
  note_endorser_code:
    data_type: VARCHAR(128)
    source:
      field: primary_source_table.columns.b_note_endorser
    update_flag: false
  obligated_loan_foreclosure:
    data_type: VARCHAR(1024)
    source:
      field: primary_source_table.foreign_keys.fkt_b_obligated_loan_foreclosure.columns.value
    update_flag: true
  obligated_loan_foreclosure_code:
    data_type: VARCHAR(128)
    source:
      field: primary_source_table.columns.b_obligated_loan_foreclosure
    update_flag: false
  on_gsa_list:
    data_type: VARCHAR(1024)
    source:
      field: primary_source_table.foreign_keys.fkt_b_on_gsa_list.columns.value
    update_flag: true
  on_gsa_list_code:
    data_type: VARCHAR(128)
    source:
      field: primary_source_table.columns.b_on_gsa_list
    update_flag: false
  on_ldp_list:
    data_type: VARCHAR(1024)
    source:
      field: primary_source_table.foreign_keys.fkt_b_on_ldp_list.columns.value
    update_flag: true
  on_ldp_list_code:
    data_type: VARCHAR(128)
    source:
      field: primary_source_table.columns.b_on_ldp_list
    update_flag: false
  outstanding_judgements:
    data_type: VARCHAR(1024)
    source:
      field: primary_source_table.foreign_keys.fkt_b_outstanding_judgements.columns.value
    update_flag: true
  outstanding_judgements_code:
    data_type: VARCHAR(128)
    source:
      field: primary_source_table.columns.b_outstanding_judgements
    update_flag: false
  party_to_lawsuit:
    data_type: VARCHAR(1024)
    source:
      field: primary_source_table.foreign_keys.fkt_b_party_to_lawsuit.columns.value
    update_flag: true
  party_to_lawsuit_code:
    data_type: VARCHAR(128)
    source:
      field: primary_source_table.columns.b_party_to_lawsuit
    update_flag: false
  presently_delinquent:
    data_type: VARCHAR(1024)
    source:
      field: primary_source_table.foreign_keys.fkt_b_presently_delinquent.columns.value
    update_flag: true
  presently_delinquent_code:
    data_type: VARCHAR(128)
    source:
      field: primary_source_table.columns.b_presently_delinquent
    update_flag: false
  property_foreclosure:
    data_type: VARCHAR(1024)
    source:
      field: primary_source_table.foreign_keys.fkt_b_property_foreclosure.columns.value
    update_flag: true
  property_foreclosure_code:
    data_type: VARCHAR(128)
    source:
      field: primary_source_table.columns.b_property_foreclosure
    update_flag: false
  spousal_homestead:
    data_type: VARCHAR(1024)
    source:
      field: primary_source_table.foreign_keys.fkt_b_spousal_homestead.columns.value
    update_flag: true
  spousal_homestead_code:
    data_type: VARCHAR(128)
    source:
      field: primary_source_table.columns.b_spousal_homestead
    update_flag: false
  titleholder:
    data_type: VARCHAR(1024)
    source:
      field: primary_source_table.foreign_keys.fkt_b_titleholder.columns.value
    update_flag: true
  titleholder_code:
    data_type: VARCHAR(128)
    source:
      field: primary_source_table.columns.b_titleholder
    update_flag: false
etls:
  SP-200006:
    input_type: table
    output_type: insert_update
    hardcoded_data_source: Octane
    json_output_field: data_source_integration_id
    insert_update_keys:
      - data_source_integration_id
    container_memory: 2048
    input_sql: |-
      WITH borrower_lending_profile_dim_new_records AS (
          SELECT 'sex_refused_code~sex_collected_visual_or_surname_code~sex_male_flag~sex_female_flag~sex_not_obtainable_flag~ethnicity_refused_code~ethnicity_collected_visual_or_surname_code~ethnicity_hispanic_or_latino_flag~ethnicity_mexican_flag~ethnicity_puerto_rican_flag~ethnicity_cuban_flag~ethnicity_other_hispanic_or_latino_flag~ethnicity_not_hispanic_or_latino_flag~ethnicity_not_obtainable_flag~marital_status_code~race_refused_code~race_collected_visual_or_surname_code~race_american_indian_or_alaska_native_flag~race_asian_flag~race_asian_indian_flag~race_chinese_flag~race_filipino_flag~race_japanese_flag~race_korean_flag~race_vietnamese_flag~race_other_asian_flag~race_black_or_african_american_flag~race_information_not_provided_flag~race_national_origin_refusal_flag~race_native_hawaiian_or_other_pacific_islander_flag~race_native_hawaiian_flag~race_guamanian_or_chamorro_flag~race_samoan_flag~race_other_pacific_islander_flag~race_not_obtainable_flag~race_not_applicable_flag~race_white_flag~schooling_years~race_other_pacific_islander_description_flag~data_source_dwid~ethnicity_other_hispanic_or_latino_description_flag~other_race_national_origin_description_flag~race_other_american_indian_or_alaska_native_description_flag~race_other_asian_description_flag' AS data_source_integration_columns
               , COALESCE( CAST( primary_table.b_alimony_child_support AS TEXT ), '<NULL>' ) || '~' ||
                 COALESCE( CAST( primary_table.b_bankruptcy AS TEXT ), '<NULL>' ) || '~' ||
                 COALESCE( CAST( primary_table.b_borrowed_down_payment AS TEXT ), '<NULL>' ) || '~' ||
                 COALESCE( CAST( primary_table.b_spousal_homestead AS TEXT ), '<NULL>' ) || '~' ||
                 COALESCE( CAST( primary_table.b_citizenship_residency_type AS TEXT ), '<NULL>' ) || '~' ||
                 COALESCE( CAST( primary_table.b_has_dependents AS TEXT ), '<NULL>' ) || '~' ||
                 COALESCE( CAST( primary_table.b_first_time_homebuyer AS TEXT ), '<NULL>' ) || '~' ||
                 COALESCE( CAST( primary_table.b_lender_employee AS TEXT ), '<NULL>' ) || '~' ||
                 COALESCE( CAST( primary_table.b_lender_employee_status_confirmed AS TEXT ), '<NULL>' ) || '~' ||
                 COALESCE( CAST( primary_table.b_homeowner_past_three_years AS TEXT ), '<NULL>' ) || '~' ||
                 COALESCE( CAST( primary_table.b_intend_to_occupy AS TEXT ), '<NULL>' ) || '~' ||
                 COALESCE( CAST( primary_table.b_note_endorser AS TEXT ), '<NULL>' ) || '~' ||
                 COALESCE( CAST( primary_table.b_obligated_loan_foreclosure AS TEXT ), '<NULL>' ) || '~' ||
                 COALESCE( CAST( primary_table.b_outstanding_judgements AS TEXT ), '<NULL>' ) || '~' ||
                 COALESCE( CAST( primary_table.b_party_to_lawsuit AS TEXT ), '<NULL>' ) || '~' ||
                 COALESCE( CAST( primary_table.b_presently_delinquent AS TEXT ), '<NULL>' ) || '~' ||
                 COALESCE( CAST( primary_table.b_property_foreclosure AS TEXT ), '<NULL>' ) || '~' ||
                 COALESCE( CAST( primary_table.b_titleholder AS TEXT ), '<NULL>' ) || '~' ||
                 COALESCE( CAST( primary_table.b_first_time_home_buyer_auto_compute AS TEXT ), '<NULL>' ) || '~' ||
                 COALESCE( CAST( primary_table.b_on_ldp_list AS TEXT ), '<NULL>' ) || '~' ||
                 COALESCE( CAST( primary_table.b_on_gsa_list AS TEXT ), '<NULL>' ) || '~' ||
                 COALESCE( CAST( primary_table.b_homeownership_education_type AS TEXT ), '<NULL>' ) || '~' ||
                 COALESCE( CAST( primary_table.b_homeownership_education_agency_type AS TEXT ), '<NULL>' ) || '~' ||
                 COALESCE( CAST( primary_table.b_disabled AS TEXT ), '<NULL>' ) || '~' ||
                 COALESCE( CAST( primary_table.b_hud_employee AS TEXT ), '<NULL>' ) || '~' ||
                 COALESCE( CAST( primary_table.b_domestic_relationship_state_type AS TEXT ), '<NULL>' ) || '~' ||
                 COALESCE( CAST( 1 AS TEXT ), '<NULL>' ) AS data_source_integration_id
               , NOW( ) AS edw_created_datetime
               , NOW( ) AS edw_modified_datetime
               , MAX( primary_table.data_source_updated_datetime ) AS data_source_modified_datetime
               , primary_table.b_alimony_child_support AS alimony_child_support_code
               , primary_table.b_bankruptcy AS bankruptcy_code
               , primary_table.b_borrowed_down_payment AS borrowed_down_payment_code
               , primary_table.b_spousal_homestead AS spousal_homestead_code
               , primary_table.b_citizenship_residency_type AS citizenship_residency_code
               , primary_table.b_has_dependents AS dependents_code
               , primary_table.b_first_time_homebuyer AS first_time_homebuyer_flag
               , primary_table.b_lender_employee AS lender_employee_code
               , primary_table.b_lender_employee_status_confirmed AS lender_employee_status_confirmed_flag
               , primary_table.b_homeowner_past_three_years AS homeowner_past_three_years_code
               , primary_table.b_intend_to_occupy AS intend_to_occupy_code
               , primary_table.b_note_endorser AS note_endorser_code
               , primary_table.b_obligated_loan_foreclosure AS obligated_loan_foreclosure_code
               , primary_table.b_outstanding_judgements AS outstanding_judgements_code
               , primary_table.b_party_to_lawsuit AS party_to_lawsuit_code
               , primary_table.b_presently_delinquent AS presently_delinquent_code
               , primary_table.b_property_foreclosure AS property_foreclosure_code
               , primary_table.b_titleholder AS titleholder_code
               , primary_table.b_first_time_home_buyer_auto_compute AS first_time_homebuyer_auto_compute_flag
               , primary_table.b_on_ldp_list AS on_ldp_list_code
               , primary_table.b_on_gsa_list AS on_gsa_list_code
               , primary_table.b_homeownership_education_type AS homeownership_education_code
               , primary_table.b_homeownership_education_agency_type AS homeownership_education_agency_code
               , primary_table.b_disabled AS disabled_code
               , primary_table.b_hud_employee AS hud_employee_flag
               , primary_table.b_domestic_relationship_state_type AS domestic_relationship_state_code
               , t119.value AS citizenship_residency
               , t127.value AS homeownership_education
               , t126.value AS homeownership_education_agency
               , t122.value AS domestic_relationship_state
               , t113.value AS alimony_child_support
               , t116.value AS bankruptcy
               , t117.value AS borrowed_down_payment
               , t121.value AS disabled
               , t125.value AS dependents
               , t128.value AS homeowner_past_three_years
               , t131.value AS intend_to_occupy
               , t133.value AS lender_employee
               , t135.value AS note_endorser
               , t136.value AS obligated_loan_foreclosure
               , t137.value AS on_gsa_list
               , t138.value AS on_ldp_list
               , t139.value AS outstanding_judgements
               , t140.value AS party_to_lawsuit
               , t143.value AS presently_delinquent
               , t146.value AS property_foreclosure
               , t153.value AS spousal_homestead
               , t154.value AS titleholder
               , MAX( GREATEST( t119.etl_end_date_time, t127.etl_end_date_time, t126.etl_end_date_time, t122.etl_end_date_time,
                                t113.etl_end_date_time, t116.etl_end_date_time, t117.etl_end_date_time, t121.etl_end_date_time,
                                t125.etl_end_date_time, t128.etl_end_date_time, t131.etl_end_date_time, t133.etl_end_date_time,
                                t135.etl_end_date_time, t136.etl_end_date_time, t137.etl_end_date_time, t138.etl_end_date_time,
                                t139.etl_end_date_time, t140.etl_end_date_time, t143.etl_end_date_time, t146.etl_end_date_time,
                                t153.etl_end_date_time, t154.etl_end_date_time ) ) AS max_source_etl_end_date_time
          FROM (
              SELECT <<borrower_partial_load_condition>> AS include_record
                   , borrower.*
              FROM history_octane.borrower
              LEFT JOIN history_octane.borrower AS history_records
                        ON borrower.b_pid = history_records.b_pid
                            AND borrower.data_source_updated_datetime < history_records.data_source_updated_datetime
              WHERE history_records.b_pid IS NULL
          ) AS primary_table
          INNER JOIN (
              SELECT *
              FROM (
                  SELECT <<citizenship_residency_type_partial_load_condition>> AS include_record
                       , citizenship_residency_type.*
                       , etl_log.etl_end_date_time
                  FROM history_octane.citizenship_residency_type
                  LEFT JOIN history_octane.citizenship_residency_type AS history_records
                            ON citizenship_residency_type.code = history_records.code
                                AND citizenship_residency_type.data_source_updated_datetime < history_records.data_source_updated_datetime
                  JOIN star_common.etl_log
                       ON citizenship_residency_type.etl_batch_id = etl_log.etl_batch_id
                  WHERE history_records.code IS NULL
              ) AS primary_table
          ) AS t119
                     ON primary_table.b_citizenship_residency_type = t119.code
          INNER JOIN (
              SELECT *
              FROM (
                  SELECT <<homeownership_education_type_partial_load_condition>> AS include_record
                       , homeownership_education_type.*
                       , etl_log.etl_end_date_time
                  FROM history_octane.homeownership_education_type
                  LEFT JOIN history_octane.homeownership_education_type AS history_records
                            ON homeownership_education_type.code = history_records.code
                                AND homeownership_education_type.data_source_updated_datetime < history_records.data_source_updated_datetime
                  JOIN star_common.etl_log
                       ON homeownership_education_type.etl_batch_id = etl_log.etl_batch_id
                  WHERE history_records.code IS NULL
              ) AS primary_table
          ) AS t127
                     ON primary_table.b_homeownership_education_type = t127.code
          INNER JOIN (
              SELECT *
              FROM (
                  SELECT <<housing_counseling_agency_type_partial_load_condition>> AS include_record
                       , housing_counseling_agency_type.*
                       , etl_log.etl_end_date_time
                  FROM history_octane.housing_counseling_agency_type
                  LEFT JOIN history_octane.housing_counseling_agency_type AS history_records
                            ON housing_counseling_agency_type.code = history_records.code
                                AND housing_counseling_agency_type.data_source_updated_datetime < history_records.data_source_updated_datetime
                  JOIN star_common.etl_log
                       ON housing_counseling_agency_type.etl_batch_id = etl_log.etl_batch_id
                  WHERE history_records.code IS NULL
              ) AS primary_table
          ) AS t126
                     ON primary_table.b_homeownership_education_agency_type = t126.code
          LEFT JOIN (
              SELECT *
              FROM (
                  SELECT <<state_type_partial_load_condition>> AS include_record
                       , state_type.*
                       , etl_log.etl_end_date_time
                  FROM history_octane.state_type
                  LEFT JOIN history_octane.state_type AS history_records
                            ON state_type.code = history_records.code
                                AND state_type.data_source_updated_datetime < history_records.data_source_updated_datetime
                  JOIN star_common.etl_log
                       ON state_type.etl_batch_id = etl_log.etl_batch_id
                  WHERE history_records.code IS NULL
              ) AS primary_table
          ) AS t122
                    ON primary_table.b_domestic_relationship_state_type = t122.code
          INNER JOIN (
              SELECT *
              FROM (
                  SELECT <<yes_no_unknown_type_partial_load_condition>> AS include_record
                       , yes_no_unknown_type.*
                       , etl_log.etl_end_date_time
                  FROM history_octane.yes_no_unknown_type
                  LEFT JOIN history_octane.yes_no_unknown_type AS history_records
                            ON yes_no_unknown_type.code = history_records.code
                                AND yes_no_unknown_type.data_source_updated_datetime < history_records.data_source_updated_datetime
                  JOIN star_common.etl_log
                       ON yes_no_unknown_type.etl_batch_id = etl_log.etl_batch_id
                  WHERE history_records.code IS NULL
              ) AS primary_table
          ) AS t113
                     ON primary_table.b_alimony_child_support = t113.code
          INNER JOIN (
              SELECT *
              FROM (
                  SELECT <<yes_no_unknown_type_partial_load_condition>> AS include_record
                       , yes_no_unknown_type.*
                       , etl_log.etl_end_date_time
                  FROM history_octane.yes_no_unknown_type
                  LEFT JOIN history_octane.yes_no_unknown_type AS history_records
                            ON yes_no_unknown_type.code = history_records.code
                                AND yes_no_unknown_type.data_source_updated_datetime < history_records.data_source_updated_datetime
                  JOIN star_common.etl_log
                       ON yes_no_unknown_type.etl_batch_id = etl_log.etl_batch_id
                  WHERE history_records.code IS NULL
              ) AS primary_table
          ) AS t116
                     ON primary_table.b_bankruptcy = t116.code
          INNER JOIN (
              SELECT *
              FROM (
                  SELECT <<yes_no_unknown_type_partial_load_condition>> AS include_record
                       , yes_no_unknown_type.*
                       , etl_log.etl_end_date_time
                  FROM history_octane.yes_no_unknown_type
                  LEFT JOIN history_octane.yes_no_unknown_type AS history_records
                            ON yes_no_unknown_type.code = history_records.code
                                AND yes_no_unknown_type.data_source_updated_datetime < history_records.data_source_updated_datetime
                  JOIN star_common.etl_log
                       ON yes_no_unknown_type.etl_batch_id = etl_log.etl_batch_id
                  WHERE history_records.code IS NULL
              ) AS primary_table
          ) AS t117
                     ON primary_table.b_borrowed_down_payment = t117.code
          INNER JOIN (
              SELECT *
              FROM (
                  SELECT <<yes_no_unknown_type_partial_load_condition>> AS include_record
                       , yes_no_unknown_type.*
                       , etl_log.etl_end_date_time
                  FROM history_octane.yes_no_unknown_type
                  LEFT JOIN history_octane.yes_no_unknown_type AS history_records
                            ON yes_no_unknown_type.code = history_records.code
                                AND yes_no_unknown_type.data_source_updated_datetime < history_records.data_source_updated_datetime
                  JOIN star_common.etl_log
                       ON yes_no_unknown_type.etl_batch_id = etl_log.etl_batch_id
                  WHERE history_records.code IS NULL
              ) AS primary_table
          ) AS t121
                     ON primary_table.b_disabled = t121.code
          INNER JOIN (
              SELECT *
              FROM (
                  SELECT <<yes_no_unknown_type_partial_load_condition>> AS include_record
                       , yes_no_unknown_type.*
                       , etl_log.etl_end_date_time
                  FROM history_octane.yes_no_unknown_type
                  LEFT JOIN history_octane.yes_no_unknown_type AS history_records
                            ON yes_no_unknown_type.code = history_records.code
                                AND yes_no_unknown_type.data_source_updated_datetime < history_records.data_source_updated_datetime
                  JOIN star_common.etl_log
                       ON yes_no_unknown_type.etl_batch_id = etl_log.etl_batch_id
                  WHERE history_records.code IS NULL
              ) AS primary_table
          ) AS t125
                     ON primary_table.b_has_dependents = t125.code
          INNER JOIN (
              SELECT *
              FROM (
                  SELECT <<yes_no_unknown_type_partial_load_condition>> AS include_record
                       , yes_no_unknown_type.*
                       , etl_log.etl_end_date_time
                  FROM history_octane.yes_no_unknown_type
                  LEFT JOIN history_octane.yes_no_unknown_type AS history_records
                            ON yes_no_unknown_type.code = history_records.code
                                AND yes_no_unknown_type.data_source_updated_datetime < history_records.data_source_updated_datetime
                  JOIN star_common.etl_log
                       ON yes_no_unknown_type.etl_batch_id = etl_log.etl_batch_id
                  WHERE history_records.code IS NULL
              ) AS primary_table
          ) AS t128
                     ON primary_table.b_homeowner_past_three_years = t128.code
          INNER JOIN (
              SELECT *
              FROM (
                  SELECT <<yes_no_unknown_type_partial_load_condition>> AS include_record
                       , yes_no_unknown_type.*
                       , etl_log.etl_end_date_time
                  FROM history_octane.yes_no_unknown_type
                  LEFT JOIN history_octane.yes_no_unknown_type AS history_records
                            ON yes_no_unknown_type.code = history_records.code
                                AND yes_no_unknown_type.data_source_updated_datetime < history_records.data_source_updated_datetime
                  JOIN star_common.etl_log
                       ON yes_no_unknown_type.etl_batch_id = etl_log.etl_batch_id
                  WHERE history_records.code IS NULL
              ) AS primary_table
          ) AS t131
                     ON primary_table.b_intend_to_occupy = t131.code
          INNER JOIN (
              SELECT *
              FROM (
                  SELECT <<yes_no_unknown_type_partial_load_condition>> AS include_record
                       , yes_no_unknown_type.*
                       , etl_log.etl_end_date_time
                  FROM history_octane.yes_no_unknown_type
                  LEFT JOIN history_octane.yes_no_unknown_type AS history_records
                            ON yes_no_unknown_type.code = history_records.code
                                AND yes_no_unknown_type.data_source_updated_datetime < history_records.data_source_updated_datetime
                  JOIN star_common.etl_log
                       ON yes_no_unknown_type.etl_batch_id = etl_log.etl_batch_id
                  WHERE history_records.code IS NULL
              ) AS primary_table
          ) AS t133
                     ON primary_table.b_lender_employee = t133.code
          INNER JOIN (
              SELECT *
              FROM (
                  SELECT <<yes_no_unknown_type_partial_load_condition>> AS include_record
                       , yes_no_unknown_type.*
                       , etl_log.etl_end_date_time
                  FROM history_octane.yes_no_unknown_type
                  LEFT JOIN history_octane.yes_no_unknown_type AS history_records
                            ON yes_no_unknown_type.code = history_records.code
                                AND yes_no_unknown_type.data_source_updated_datetime < history_records.data_source_updated_datetime
                  JOIN star_common.etl_log
                       ON yes_no_unknown_type.etl_batch_id = etl_log.etl_batch_id
                  WHERE history_records.code IS NULL
              ) AS primary_table
          ) AS t135
                     ON primary_table.b_note_endorser = t135.code
          INNER JOIN (
              SELECT *
              FROM (
                  SELECT <<yes_no_unknown_type_partial_load_condition>> AS include_record
                       , yes_no_unknown_type.*
                       , etl_log.etl_end_date_time
                  FROM history_octane.yes_no_unknown_type
                  LEFT JOIN history_octane.yes_no_unknown_type AS history_records
                            ON yes_no_unknown_type.code = history_records.code
                                AND yes_no_unknown_type.data_source_updated_datetime < history_records.data_source_updated_datetime
                  JOIN star_common.etl_log
                       ON yes_no_unknown_type.etl_batch_id = etl_log.etl_batch_id
                  WHERE history_records.code IS NULL
              ) AS primary_table
          ) AS t136
                     ON primary_table.b_obligated_loan_foreclosure = t136.code
          INNER JOIN (
              SELECT *
              FROM (
                  SELECT <<yes_no_unknown_type_partial_load_condition>> AS include_record
                       , yes_no_unknown_type.*
                       , etl_log.etl_end_date_time
                  FROM history_octane.yes_no_unknown_type
                  LEFT JOIN history_octane.yes_no_unknown_type AS history_records
                            ON yes_no_unknown_type.code = history_records.code
                                AND yes_no_unknown_type.data_source_updated_datetime < history_records.data_source_updated_datetime
                  JOIN star_common.etl_log
                       ON yes_no_unknown_type.etl_batch_id = etl_log.etl_batch_id
                  WHERE history_records.code IS NULL
              ) AS primary_table
          ) AS t137
                     ON primary_table.b_on_gsa_list = t137.code
          INNER JOIN (
              SELECT *
              FROM (
                  SELECT <<yes_no_unknown_type_partial_load_condition>> AS include_record
                       , yes_no_unknown_type.*
                       , etl_log.etl_end_date_time
                  FROM history_octane.yes_no_unknown_type
                  LEFT JOIN history_octane.yes_no_unknown_type AS history_records
                            ON yes_no_unknown_type.code = history_records.code
                                AND yes_no_unknown_type.data_source_updated_datetime < history_records.data_source_updated_datetime
                  JOIN star_common.etl_log
                       ON yes_no_unknown_type.etl_batch_id = etl_log.etl_batch_id
                  WHERE history_records.code IS NULL
              ) AS primary_table
          ) AS t138
                     ON primary_table.b_on_ldp_list = t138.code
          INNER JOIN (
              SELECT *
              FROM (
                  SELECT <<yes_no_unknown_type_partial_load_condition>> AS include_record
                       , yes_no_unknown_type.*
                       , etl_log.etl_end_date_time
                  FROM history_octane.yes_no_unknown_type
                  LEFT JOIN history_octane.yes_no_unknown_type AS history_records
                            ON yes_no_unknown_type.code = history_records.code
                                AND yes_no_unknown_type.data_source_updated_datetime < history_records.data_source_updated_datetime
                  JOIN star_common.etl_log
                       ON yes_no_unknown_type.etl_batch_id = etl_log.etl_batch_id
                  WHERE history_records.code IS NULL
              ) AS primary_table
          ) AS t139
                     ON primary_table.b_outstanding_judgements = t139.code
          INNER JOIN (
              SELECT *
              FROM (
                  SELECT <<yes_no_unknown_type_partial_load_condition>> AS include_record
                       , yes_no_unknown_type.*
                       , etl_log.etl_end_date_time
                  FROM history_octane.yes_no_unknown_type
                  LEFT JOIN history_octane.yes_no_unknown_type AS history_records
                            ON yes_no_unknown_type.code = history_records.code
                                AND yes_no_unknown_type.data_source_updated_datetime < history_records.data_source_updated_datetime
                  JOIN star_common.etl_log
                       ON yes_no_unknown_type.etl_batch_id = etl_log.etl_batch_id
                  WHERE history_records.code IS NULL
              ) AS primary_table
          ) AS t140
                     ON primary_table.b_party_to_lawsuit = t140.code
          INNER JOIN (
              SELECT *
              FROM (
                  SELECT <<yes_no_unknown_type_partial_load_condition>> AS include_record
                       , yes_no_unknown_type.*
                       , etl_log.etl_end_date_time
                  FROM history_octane.yes_no_unknown_type
                  LEFT JOIN history_octane.yes_no_unknown_type AS history_records
                            ON yes_no_unknown_type.code = history_records.code
                                AND yes_no_unknown_type.data_source_updated_datetime < history_records.data_source_updated_datetime
                  JOIN star_common.etl_log
                       ON yes_no_unknown_type.etl_batch_id = etl_log.etl_batch_id
                  WHERE history_records.code IS NULL
              ) AS primary_table
          ) AS t143
                     ON primary_table.b_presently_delinquent = t143.code
          INNER JOIN (
              SELECT *
              FROM (
                  SELECT <<yes_no_unknown_type_partial_load_condition>> AS include_record
                       , yes_no_unknown_type.*
                       , etl_log.etl_end_date_time
                  FROM history_octane.yes_no_unknown_type
                  LEFT JOIN history_octane.yes_no_unknown_type AS history_records
                            ON yes_no_unknown_type.code = history_records.code
                                AND yes_no_unknown_type.data_source_updated_datetime < history_records.data_source_updated_datetime
                  JOIN star_common.etl_log
                       ON yes_no_unknown_type.etl_batch_id = etl_log.etl_batch_id
                  WHERE history_records.code IS NULL
              ) AS primary_table
          ) AS t146
                     ON primary_table.b_property_foreclosure = t146.code
          INNER JOIN (
              SELECT *
              FROM (
                  SELECT <<yes_no_unknown_type_partial_load_condition>> AS include_record
                       , yes_no_unknown_type.*
                       , etl_log.etl_end_date_time
                  FROM history_octane.yes_no_unknown_type
                  LEFT JOIN history_octane.yes_no_unknown_type AS history_records
                            ON yes_no_unknown_type.code = history_records.code
                                AND yes_no_unknown_type.data_source_updated_datetime < history_records.data_source_updated_datetime
                  JOIN star_common.etl_log
                       ON yes_no_unknown_type.etl_batch_id = etl_log.etl_batch_id
                  WHERE history_records.code IS NULL
              ) AS primary_table
          ) AS t153
                     ON primary_table.b_spousal_homestead = t153.code
          INNER JOIN (
              SELECT *
              FROM (
                  SELECT <<yes_no_unknown_type_partial_load_condition>> AS include_record
                       , yes_no_unknown_type.*
                       , etl_log.etl_end_date_time
                  FROM history_octane.yes_no_unknown_type
                  LEFT JOIN history_octane.yes_no_unknown_type AS history_records
                            ON yes_no_unknown_type.code = history_records.code
                                AND yes_no_unknown_type.data_source_updated_datetime < history_records.data_source_updated_datetime
                  JOIN star_common.etl_log
                       ON yes_no_unknown_type.etl_batch_id = etl_log.etl_batch_id
                  WHERE history_records.code IS NULL
              ) AS primary_table
          ) AS t154
                     ON primary_table.b_titleholder = t154.code
          WHERE GREATEST( primary_table.include_record, t119.include_record, t127.include_record, t126.include_record, t122.include_record,
                          t113.include_record, t116.include_record, t117.include_record, t121.include_record, t125.include_record,
                          t128.include_record, t131.include_record, t133.include_record, t135.include_record, t136.include_record,
                          t137.include_record, t138.include_record, t139.include_record, t140.include_record, t143.include_record,
                          t146.include_record, t153.include_record, t154.include_record ) IS TRUE
          GROUP BY t119.value, primary_table.b_alimony_child_support, primary_table.b_bankruptcy, primary_table.b_borrowed_down_payment
                 , primary_table.b_spousal_homestead, primary_table.b_citizenship_residency_type, primary_table.b_has_dependents
                 , primary_table.b_first_time_homebuyer, primary_table.b_lender_employee, primary_table.b_lender_employee_status_confirmed
                 , primary_table.b_homeowner_past_three_years, primary_table.b_intend_to_occupy, primary_table.b_note_endorser
                 , primary_table.b_obligated_loan_foreclosure, primary_table.b_outstanding_judgements, primary_table.b_party_to_lawsuit
                 , primary_table.b_presently_delinquent, primary_table.b_property_foreclosure, primary_table.b_titleholder
                 , primary_table.b_first_time_home_buyer_auto_compute, primary_table.b_on_ldp_list, primary_table.b_on_gsa_list
                 , primary_table.b_homeownership_education_type, primary_table.b_homeownership_education_agency_type
                 , primary_table.b_disabled, primary_table.b_hud_employee
                 , primary_table.b_domestic_relationship_state_type, t127.value, t126.value, t122.value, t113.value, t116.value, t117.value
                 , t121.value, t125.value, t128.value, t131.value, t133.value, t135.value, t136.value, t137.value, t138.value, t139.value
                 , t140.value, t143.value, t146.value, t153.value, t154.value
      )
      --new records that should be inserted
      SELECT borrower_lending_profile_dim_new_records.*
      FROM borrower_lending_profile_dim_new_records
      LEFT JOIN star_loan.borrower_lending_profile_dim
                ON borrower_lending_profile_dim_new_records.data_source_integration_id = borrower_lending_profile_dim.data_source_integration_id
      WHERE borrower_lending_profile_dim.dwid IS NULL
      UNION ALL
      --existing records that need to be updated
      SELECT borrower_lending_profile_dim_new_records.*
      FROM borrower_lending_profile_dim_new_records
      JOIN (
          SELECT borrower_lending_profile_dim.data_source_integration_id, etl_log.etl_start_date_time
          FROM star_loan.borrower_lending_profile_dim
          JOIN star_common.etl_log
               ON borrower_lending_profile_dim.etl_batch_id = etl_log.etl_batch_id
      ) AS borrower_lending_profile_dim_etl_start_times
           ON borrower_lending_profile_dim_new_records.data_source_integration_id =
              borrower_lending_profile_dim_etl_start_times.data_source_integration_id
               AND borrower_lending_profile_dim_new_records.max_source_etl_end_date_time >=
                   borrower_lending_profile_dim_etl_start_times.etl_start_date_time;
next_etls:
  - SP-300001-insert-update
